(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{183:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._m(1),t._m(2),t._m(3),n("p",[t._v("当 "),n("code",[t._v("extractBundles")]),t._v(" 选项被添加，webpack就做了许多的工作，这些工作在 "),n("a",{attrs:{href:"https://lvzhenbang.github.io/webpack-book/zh/building/02_bundle_splitting.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("构建拆分")]),n("OutboundLink")],1),t._v(" 这章做了详细的介绍。为了提取mnifest，可以像下面这样配置 "),n("code",[t._v("optimization.runtimeChunk")]),t._v(" ：")]),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),n("p",[t._v("如："),n("a",{attrs:{href:"https://www.npmjs.com/package/inline-manifest-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("inline-manifest-webpack-plugin"),n("OutboundLink")],1),t._v(" 和 "),n("a",{attrs:{href:"https://www.npmjs.com/package/html-webpack-inline-chunk-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("html-webpack-inline-chunk-plugin"),n("OutboundLink")],1),t._v(" 。 "),n("a",{attrs:{href:"https://www.npmjs.com/package/assets-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("assets-webpack-plugin"),n("OutboundLink")],1),t._v(" 和 "),n("code",[t._v("HtmlWebpackPlugin")]),t._v(" 一起使用，允许你将 "),n("code",[t._v("manifest")]),t._v(" 写入 "),n("code",[t._v("index.html")]),t._v(" ，来减少一次请求。")]),t._m(10),t._m(11),n("blockquote",[n("p",[t._v("为了使用asset管道，你可以使用 "),n("a",{attrs:{href:"https://www.npmjs.com/package/chunk-manifest-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("chunk-manifest-webpack-plugin"),n("OutboundLink")],1),t._v("， "),n("a",{attrs:{href:"https://www.npmjs.com/package/webpack-manifest-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack-manifest-plugin"),n("OutboundLink")],1),t._v("， "),n("a",{attrs:{href:"https://www.npmjs.com/package/webpack-assets-manifest",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack-assets-manifest"),n("OutboundLink")],1),t._v("，或 "),n("a",{attrs:{href:"https://www.npmjs.com/package/webpack-rails-manifest-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack-rails-manifest-plugin"),n("OutboundLink")],1),t._v(" 插件。这些解决方案使用JSON形式的将原始静态资源路径映射到新静态资源路径。")])]),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),n("p",[t._v("内容回顾：")]),t._m(24),n("p",[t._v("在下一章中，你将学习如何分析构建，因为它对于理解和改进构建至关重要。")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"分离的-manifest"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分离的-manifest","aria-hidden":"true"}},[this._v("#")]),this._v(" 分离的 manifest")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("当webpack写入bundle时，它也会维护 "),n("code",[t._v("manifest")]),t._v("。你可以在此项目中找到生成的 "),n("code",[t._v("vendor")]),t._v(" 包。webpack应加载的 "),n("code",[t._v("manifest")]),t._v(" 中的文件。可以更快地提取并开始加载文件，而不必等待加载 "),n("code",[t._v("vendor")]),t._v(" 包。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如何webpack生成的hash改变，"),s("code",[this._v("manifest")]),this._v(" 也将改变。因此，"),s("code",[this._v("vendor")]),this._v(" 包的内容也将改变，并变得无效。可以通过将其提取到自己的文件中，或通过将其内联写入项目的 "),s("code",[this._v("index.html")]),this._v(" 来解决该问题。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"提取manifest"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#提取manifest","aria-hidden":"true"}},[this._v("#")]),this._v(" 提取Manifest")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("webpack.config.js")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" productionConfig "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("merge")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    optimization"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      splitChunks"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      runtimeChunk"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        name"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"manifest"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("模块的名字通常用 "),s("code",[this._v("manifest")]),this._v(" 。当然，你也可以自定义名字。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("运行 "),s("code",[this._v("npm run build")]),this._v(" 脚本命令，你将看到下面的输出：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("Hash: 2e1c61341de0fd7e0e5c\nVersion: webpack 4.1.1\nTime: 3347ms\nBuilt at: 3/16/2018 6:24:51 PM\n                   Asset       Size  Chunks             Chunk Names\n       manifest.d41d.css    0 bytes       1  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  manifest\n               0.73a8.js  160 bytes       0  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    vendors~main.3af5.js   96.8 KiB       2  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  vendors~main\n            main.8da2.js  546 bytes       3  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  main\n           main.5524.css    1.2 KiB       3  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  main\n   vendors~main.3dd5.css   1.32 KiB       2  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  vendors~main\n        manifest.8cac.js   1.81 KiB       1  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  manifest\n           0.73a8.js.map  203 bytes       0  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    manifest.8cac.js.map     10 KiB       1  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  manifest\nvendors~main.3af5.js.map    235 KiB       2  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  vendors~main\n        main.8da2.js.map   1.45 KiB       3  "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  main\n              index.html  460 bytes          "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这样的改变，给你了一个分离的 "),n("code",[t._v("manifest")]),t._v(" 文件，模块的名字是 "),n("code",[t._v("manifest")]),t._v(" 。因为使用了 "),n("code",[t._v("HtmlWebpackPlugin")]),t._v(" ，没有必要担心加载 "),n("code",[t._v("manifest")]),t._v(" ，插件会添加 "),n("code",[t._v("manifest")]),t._v(" 的引用到 "),n("code",[t._v("index.html")]),t._v(" 。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("尝试改变 "),n("code",[t._v("src/index.js")]),t._v(" ，然后看看hash如何改变。"),n("code",[t._v("vendor")]),t._v(" 包将变得无效，"),n("code",[t._v("manifest")]),t._v(" 和 "),n("code",[t._v("app")]),t._v(" 包的名字将随之改变。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("要更好地了解 "),s("code",[this._v("manifest")]),this._v(" 内容，请在开发模式下运行构建，或通过配置将 "),s("code",[this._v("none")]),this._v(" 传递给模式。你应该看到相似的东西。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("通过CDN加载流行的依赖项（如React）可以进一步改进构建。这将进一步减少 "),s("code",[this._v("vendor")]),this._v(" 包的大小，同时增加对项目的外部依赖性。 它的想法是如果用户较早的触发CDN，缓存可以像这里一样启动。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"使用records"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用records","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用Records")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("正如构建查分章节中介绍的那样， "),s("code",[this._v("AggressiveSplittingPlugin")]),this._v(" 插件可以使用 "),s("code",[this._v("records")]),this._v(" 实现缓存。这些方法仍然有效，但 "),s("code",[this._v("record")]),this._v(" 更进了一步。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("record")]),this._v(" 记录构建分离生成的模块ID。问题是你需要保存此文件。如果你在本地构建，则可以选择将其包含在版本控制中。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("像下面这样调整配置，会生成一个 "),s("code",[this._v("records.json")]),this._v(" 文件：\n"),s("strong",[this._v("webpack.config.js")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" productionConfig "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("merge")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    recordsPath"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("join")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"records.json"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("运行"),s("code",[this._v("npm run build")]),this._v(" 脚本命令，你将在项目的根目录下看到一个 "),s("code",[this._v("records.json")]),this._v(" 文件。如果下一次构建中有模块的改变，webpack将重写 "),s("code",[this._v("records.json")]),this._v(" 文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你遇到拆分问题，并希望确保拆分部分获得正确的缓存行为，那么 "),s("code",[this._v("record")]),this._v(" 会特别有用。最大的问题是维护 "),s("code",[this._v("record")]),this._v(" 文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[s("code",[this._v("recordsInputPath")]),this._v(" 和 "),s("code",[this._v("recordsOutputPath")]),this._v(" 对输入和输出进行更精细的控制，但通常只设置 "),s("code",[this._v("recordsPath")]),this._v(" 就足够了。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("如果更改Web模块处理模块ID的方式（即删除"),s("code",[this._v("HashedModuleIdsPlugin")]),this._v("），仍需考虑可能的"),s("code",[this._v("record")]),this._v("！如果要使用新模块ID方案，那么必须删除 "),s("code",[this._v("record.json")]),this._v(" 文件。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("The project has basic caching behavior now. If you try to modify "),s("code",[this._v("index.js")]),this._v(" or "),s("code",[this._v("component.js")]),this._v(", the vendor bundle should remain the same.")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("Webpack 通过维护 "),n("code",[t._v("manifest")]),t._v(" ，来控制应用程序加载所需要的信息。")]),n("li",[t._v("如果 "),n("code",[t._v("manifest")]),t._v(" , 那么它所包含的包将失效。")]),n("li",[t._v("有些插件允许你将 "),n("code",[t._v("mainfest")]),t._v(" 注入到 "),n("code",[t._v("index.html")]),t._v(" 中。也可以提取模块信息到一个JSON文件中。JSON文件这种方式在SSR中很方便。")]),n("li",[n("code",[t._v("Records")]),t._v(" 记录构建生成的模块ID。缺点是，你必须跟踪 "),n("code",[t._v("record.json")]),t._v(" 文件。")])])}],!1,null,null,null);e.options.__file="05_separating_manifest.md";s.default=e.exports}}]);