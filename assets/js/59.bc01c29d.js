(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{144:function(t,e,s){t.exports=s.p+"assets/img/no-refresh2.a03a946a.png"},145:function(t,e,s){t.exports=s.p+"assets/img/hmr.9c047192.png"},264:function(t,e,s){"use strict";s.r(e);var a=[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"hot-module-replacement"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hot-module-replacement","aria-hidden":"true"}},[this._v("#")]),this._v(" Hot Module Replacement")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Hot Module Replacement")]),this._v(" (HMR) builds on top of the WDS. It enables an interface that makes it possible to swap modules live. For example, "),e("em",[this._v("style-loader")]),this._v(" can update your CSS without forcing a refresh. Implementing HMR for styles is ideal because CSS is stateless by design.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Given HMR can be complex to implement, a good compromise is to store application state to "),e("code",[this._v("localStorage")]),this._v(" and then hydrate the application based on that after a refresh. Doing this pushes the problem to the application side.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"启用hmr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启用hmr","aria-hidden":"true"}},[this._v("#")]),this._v(" 启用HMR")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("WDS has to run in the hot mode to expose the hot module replacement interface to the client.")]),s("li",[t._v("Webpack has to provide hot updates to the server and can be achieved using "),s("code",[t._v("webpack.HotModuleReplacementPlugin")]),t._v(".")]),s("li",[t._v("The client has to run specific scripts provided by the WDS. They will be injected automatically but can be enabled explicitly through entry configuration.")]),s("li",[t._v("The client has to implement the HMR interface through "),s("code",[t._v("module.hot.accept")]),t._v(".")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Using "),e("code",[this._v("webpack-dev-server --hot")]),this._v(" solves the first two problems. In this case, you have to handle only the last one yourself if you want to patch JavaScript application code. Skipping the "),e("code",[this._v("--hot")]),this._v(" flag and going through webpack configuration gives more flexibility.")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  devServer"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Don't refresh if hot loading fails. Good while")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// implementing the client interface.")]),t._v("\n    hotOnly"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// If you want to refresh on errors too, set")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// hot: true,")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Enable the plugin to let webpack communicate changes")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// to WDS. --hot sets this automatically!")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("webpack"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HotModuleReplacementPlugin")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(144),alt:"No refresh"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("The setup assumes you have enabled "),e("code",[this._v("webpack.NamedModulesPlugin()")]),this._v(". If you run webpack in "),e("code",[this._v("development")]),this._v(" mode, it will be on by default.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("You should "),e("strong",[this._v("not")]),this._v(" enable HMR for your production configuration. It likely works, but it makes your bundles more significant than they should be.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("If you are using Babel, configure it so that it lets webpack control module generation as otherwise, HMR logic won't work!")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"implementing-the-hmr-interface"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#implementing-the-hmr-interface","aria-hidden":"true"}},[this._v("#")]),this._v(" Implementing the HMR Interface")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Webpack exposes the HMR interface through a global variable: "),e("code",[this._v("module.hot")]),this._v(". It provides updates through "),e("code",[this._v("module.hot.accept(<path to watch>, <handler>)")]),this._v(" function and you need to patch the application there.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("src/index.js")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" component "),s("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"./component"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" demoComponent "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("component")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("demoComponent"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// HMR interface")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// Capture hot update")]),t._v("\n  module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("accept")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"./component"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nextComponent "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("component")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Replace old content with the hot loaded one")]),t._v("\n    document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("replaceChild")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextComponent"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" demoComponent"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    demoComponent "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextComponent"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you refresh the browser, try to modify "),e("em",[this._v("src/component.js")]),this._v(" after this change, and alter the text to something else, you should notice that the browser does not refresh at all. Instead, it should replace the DOM node while retaining the rest of the application as is.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(145),alt:"Patched a module successfully through HMR"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("The "),e("code",[this._v("if(module.hot)")]),this._v(" block is eliminated entirely from the production build as minifier picks it up. The "),e("em",[this._v("Minifying")]),this._v(" chapter delves deeper into this topic.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"setting-wds-entry-points-manually"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setting-wds-entry-points-manually","aria-hidden":"true"}},[this._v("#")]),this._v(" Setting WDS Entry Points Manually")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("entry"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  hmr"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Include the client code. Note host/post.")]),t._v("\n    "),s("span",{attrs:{class:"token string"}},[t._v('"webpack-dev-server/client?http://localhost:8080"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Hot reload only when compiled successfully")]),t._v("\n    "),s("span",{attrs:{class:"token string"}},[t._v('"webpack/hot/only-dev-server"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Alternative with refresh on failure")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v('// "webpack/hot/dev-server",')]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"hmr-and-dynamic-loading"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hmr-and-dynamic-loading","aria-hidden":"true"}},[this._v("#")]),this._v(" HMR and Dynamic Loading")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("Dynamic Loading")]),this._v(" through "),e("code",[this._v("require.context")]),this._v(" and HMR requires extra effort:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" require"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("context")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"./pages"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token regex"}},[t._v("/^(.*\\.(jsx$))[^.]*$/g")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("accept")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("...")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// Replace modules here as above")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("HMR is one of those aspects of webpack that makes it attractive for developers and webpack has taken its implementation far. To work, HMR requires both client and server side support. For this purpose, webpack-dev-server provides both. Often you have to implement the client side interface although loaders like "),e("em",[this._v("style-loader")]),this._v(" implement it for you.")])}],n=s(0),o=Object(n.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._m(1),s("p",[t._v("HMR is possible with JavaScript too, but due to application state, it's harder. "),s("a",{attrs:{href:"https://github.com/gaearon/react-hot-loader/",target:"_blank",rel:"noopener noreferrer"}},[t._v("react-hot-loader"),s("OutboundLink")],1),t._v(" and "),s("a",{attrs:{href:"https://www.npmjs.com/package/vue-hot-reload-api",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-hot-reload-api"),s("OutboundLink")],1),t._v(" are good examples.")]),t._m(2),t._m(3),s("p",[t._v("The following steps need to be enabled for HMR to work:")]),t._m(4),t._m(5),s("p",[t._v("The following listing contains the essential parts related to this approach. You will have to adapt from here to match your configuration style:")]),t._m(6),s("p",[t._v("If you implement configuration like above without implementing the client interface, you will most likely end up with an error:")]),t._m(7),s("p",[t._v("The message tells that even though the HMR interface notified the client portion of the code of a hot update, nothing was done about it and this is something to fix next.")]),t._m(8),s("blockquote",[s("p",[s("em",[t._v("webpack-dev-server")]),t._v(" can be picky about paths. Webpack "),s("a",{attrs:{href:"https://github.com/webpack/webpack/issues/675",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue #675"),s("OutboundLink")],1),t._v(" discusses the problem in more detail.")])]),t._m(9),t._m(10),t._m(11),t._m(12),s("p",[t._v("The following implementation illustrates the idea against the tutorial application:")]),t._m(13),t._m(14),t._m(15),s("p",[t._v("The image below shows possible output:")]),t._m(16),s("p",[t._v("The idea is the same with styling, React, Redux, and other technologies. Sometimes you don't have to implement the interface yourself even as available tooling takes care of that for you.")]),s("blockquote",[s("p",[t._v("To prove that HMR retains application state, set up "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox",target:"_blank",rel:"noopener noreferrer"}},[t._v("a checkbox"),s("OutboundLink")],1),t._v(" based component next to the original. The "),s("code",[t._v("module.hot.accept")]),t._v(" code has to evolve to capture changes to it as well.")])]),t._m(17),t._m(18),s("p",[t._v("In the setup above, the WDS-related entries were injected automatically. Assuming you are using WDS through Node, you would have to set them yourself as the Node API doesn't support injecting. The example below illustrates how to achieve this:")]),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24)])},a,!1,null,null,null);o.options.__file="02_hmr.md";e.default=o.exports}}]);