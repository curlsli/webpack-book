(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{184:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("p",[t._v("虽然构建可以工作，但是它生成的文件名也是有问题的。它不允许有效利用客户端级别的缓存，因为无法判断文件是否已更改。可以通过在文件名中包含哈希来实现缓存失效。")]),t._m(1),t._m(2),t._m(3),t._m(4),t._m(5),a("blockquote",[a("p",[t._v("有更多可用选项，你甚至可以修改hash和摘要类型，如"),a("a",{attrs:{href:"https://www.npmjs.com/package/loader-utils#interpolatename",target:"_blank",rel:"noopener noreferrer"}},[t._v("loader-utils"),a("OutboundLink")],1),t._v("文档中所述。")])]),t._m(6),a("p",[t._v("你可以像下面这样修改配置代码：")]),t._m(7),a("p",[t._v("webpack将生成如下的文件名：")]),t._m(8),t._m(9),a("p",[t._v("通过生成静态文件名和查询字符串（例如："),a("code",[t._v("main.js?d587bbd6e38337f5accd")]),t._v("）使缓存无效，可以实现相同的结果。问号背后的部分使缓存无效。根据"),a("a",{attrs:{href:"http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Steve Souders"),a("OutboundLink")],1),t._v("，将哈希值附加到文件名是最高性能的选项。")]),t._m(10),t._m(11),t._m(12),t._m(13),a("blockquote",[a("p",[t._v("通过 "),a("code",[t._v("file-loader")]),t._v(" 定义 "),a("code",[t._v("[hash]")]),t._v(" 与webpack的其它部分不同。它是根据文件内容计算的。 详细信息可参考 "),a("a",{attrs:{href:"https://www.npmjs.com/package/file-loader#placeholders",target:"_blank",rel:"noopener noreferrer"}},[t._v("file-loader"),a("OutboundLink")],1),t._v(" 文档。")])]),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),a("p",[t._v("将与文件内容相关的哈希包括在其文件名中，这允许在客户端使它们无效。如果哈希值已更改，则会强制客户端再次下载该静态资源。")]),a("p",[t._v("内容回顾：")]),t._m(24),a("p",[t._v("即使现在项目产生hash，输出也不完美。问题是如果应用程序发生更改，它也会使 "),a("code",[t._v("vendor")]),t._v(" 包无效。下一章"),a("a",{attrs:{href:"https://lvzhenbang.github.io/webpack-book/zh/optimizing/05_separating_manifest.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("分离的manifest"),a("OutboundLink")],1),t._v("将深入探讨该主题，并向你展示如何提取 "),a("code",[t._v("manifest")]),t._v(" 以解决问题。")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"在文件名中添加hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在文件名中添加hash","aria-hidden":"true"}},[this._v("#")]),this._v(" 在文件名中添加hash")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"占位符"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#占位符","aria-hidden":"true"}},[this._v("#")]),this._v(" 占位符")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Webpack为此提供"),s("code",[this._v("占位符")]),this._v("。这些字符串用于将特定信息附加到webpack输出。可选的值如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("[id]")]),t._v(" - 返回模块id。")]),a("li",[a("code",[t._v("[path]")]),t._v(" - 返回文件路径。")]),a("li",[a("code",[t._v("[name]")]),t._v(" - 返回文件名。")]),a("li",[a("code",[t._v("[ext]")]),t._v(" - 返回扩展名。 "),a("code",[t._v("[ext]")]),t._v(" 是非常有用的字段。 "),a("code",[t._v("MiniCssExtractPlugin")]),t._v(" 也使用这个字段。")]),a("li",[a("code",[t._v("[hash]")]),t._v(" - 返回构建生成的hash。如果构建的任何部分发生变化，这也会发生变化。")]),a("li",[a("code",[t._v("[chunkhash]")]),t._v(" - 返回入口指定模块的hash。每个 "),a("code",[t._v("entry")]),t._v(" 在配置中定义的接收自己的哈希。 如果"),a("code",[t._v("entry")]),t._v("的任何部分发生变化，则哈希值也会变化。根据定义，"),a("code",[t._v("[chunkhash]")]),t._v("比"),a("code",[t._v("[hash]")]),t._v("更精细。")]),a("li",[a("code",[t._v("[contenthash]")]),t._v(" - 返回基于内容生成的哈希。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("hash")]),this._v(" 和 "),s("code",[this._v("chunkhash")]),this._v(" 通常仅用于生产目的，因为hash在开发过程中没有太大作用。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("blockquote",[a("p",[t._v("可以使用特定语法对 "),a("code",[t._v("hash")]),t._v(" 和 "),a("code",[t._v("chunkhash")]),t._v(" 进行切片："),a("code",[t._v("[chunkhash：4]")]),t._v("。而不是像"),a("code",[t._v("8c4cbfdb91ff93f3f3c5")]),t._v(" 这样的切片生成 "),a("code",[t._v("8c4c")]),t._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"占位符demo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#占位符demo","aria-hidden":"true"}},[this._v("#")]),this._v(" 占位符demo")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PATHS")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("build"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"[name].[chunkhash].js"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("main.d587bbd6e38337f5accd.js\nvendor.dc746a5db4ed650296e1.js\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果与模块相关的文件内容不同，则hash也会改变，因此缓存变得无效。更准确地说，浏览器发送新文件的新请求。如果只更新 "),s("code",[this._v("main")]),this._v(" 包，则只需要再次请求该文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"配置-hashing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-hashing","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 Hashing")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("构建需要调整以生成合适的哈希。图片和字体应该接收 "),s("code",[this._v("hash")]),this._v("，而块应该在模块名中使用 "),s("code",[this._v("chunkhash")]),this._v(" 来正确地使它们无效：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("webpack.config.js")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" productionConfig "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("merge")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      chunkFilename"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"[name].[chunkhash:4].js"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"[name].[chunkhash:4].js"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  parts"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("loadImages")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    options"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      limit"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("15000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token comment"}},[t._v('// name: "[name].[ext]",')]),t._v("\n      name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"[name].[hash:4].[ext]"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你对提取的CSS也使用 "),s("code",[this._v("chunkhash")]),this._v(" 这会导致问题，因为代码通过JavaScript将CSS指向同一个"),s("code",[this._v("entry")]),this._v("。这意味着如果应用程序代码或CSS发生了变化，它将使两者无效。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("因此，你可以使用基于提取的内容而生成的 "),s("code",[this._v("contenthash")]),this._v(" 而不是 "),s("code",[this._v("chunkhash")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("webpack.parts.js")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("extractCSS")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" include"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exclude"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" use "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Output extracted CSS to a file")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" plugin "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("MiniCssExtractPlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v('// filename: "[name].css",')]),t._v("\n    filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"[name].[contenthash:4].css"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("hash的切片使得输出更适合。在实践中，你可以跳过切片。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("运行 "),s("code",[this._v("npm run build")]),this._v(" 脚本命令，你将看到下面的输出内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Hash: fb67c5fd35454da1d6ff\nVersion: webpack 4.1.1\nTime: 3034ms\nBuilt at: 3/16/2018 6:18:07 PM\n                   Asset       Size  Chunks             Chunk Names\n               0.0847.js  161 bytes       0  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    vendors~main.d2f1.js   96.8 KiB       1  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  vendors~main\n            main.745c.js   2.25 KiB       2  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  main\n           main.5524.css    1.2 KiB       2  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  main\n   vendors~main.3dd5.css   1.32 KiB       1  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  vendors~main\n           0.0847.js.map  203 bytes       0  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nvendors~main.d2f1.js.map    235 KiB       1  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  vendors~main\n        main.745c.js.map   11.4 KiB       2  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  main\n              index.html  349 bytes          "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("emitted"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nEntrypoint main "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" vendors~main.d2f1.js "),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("文件现在有统一的哈希。为了使它适用于样式，你可以尝试改变 "),s("code",[this._v("src/main.css")]),this._v(" 并查看重新构建时哈希会发生什么变化。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("但是有一个问题，如果更改应用程序代码，它也会使 "),s("code",[this._v("vendor")]),this._v(" 文件无效！解决这个问题需要提取 "),s("code",[this._v("manifest")]),this._v("，但在此之前，你可以改进生产构建处理模块ID的方式。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("Webpack 的 "),a("code",[t._v("占位符")]),t._v(" 允许你定义文件名，并在它们中注入hash。")]),a("li",[t._v("最常用的占位符是 "),a("code",[t._v("[name]")]),t._v("、"),a("code",[t._v("[chunkhash]")]),t._v(" 和 "),a("code",[t._v("[ext]")]),t._v("。基于静态资源所属的 "),a("code",[t._v("entry")]),t._v(" 生成块hash。")]),a("li",[t._v("如果你正在使用 "),a("code",[t._v("MiniCssExtractPlugin")]),t._v("，你应该使用 "),a("code",[t._v("[contenthash]")]),t._v(" 。这样只有在内容发生更改时，生成的静态文件才会失效。")])])}],!1,null,null,null);e.options.__file="04_adding_hashes_to_filenames.md";s.default=e.exports}}]);