(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{215:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._m(1),a("p",[t._v("另一个不错的方法，在生成的每个文件顶部的注释中，添加本身的构建信息，至少包括版本信息。")]),t._m(2),t._m(3),t._m(4),a("p",[t._v("首先，在项目中安装 "),a("a",{attrs:{href:"https://www.npmjs.com/package/clean-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("clean-webpack-plugin"),a("OutboundLink")],1),t._v(" 依赖：")]),t._m(5),a("p",[t._v("接下来，你需要定义一个函数来包装基本的配置。你可以直接使用该插件，这样可以保证跨项目的使用，因此将其推送到库是有意义的：")]),t._m(6),t._m(7),a("p",[t._v("Connect it with the project:")]),t._m(8),t._m(9),t._m(10),t._m(11),a("p",[t._v("将与当前构建版本相关的信息附加到构建文件中，这样便于调试。 [webpack.BannerPlugin]（https://webpack.js.org/plugins/banner-plugin/）允许你实现此目的。 它可以与[git-revision-webpack-plugin]（https://www.npmjs.com/package/git-revision-webpack-plugin）结合使用，在生成的文件的开头生成一个小注释。")]),t._m(12),a("p",[t._v("在项目中安装revision插件：")]),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),a("p",[t._v("可以通过调整 "),a("code",[t._v("banner")]),t._v(" 进一步自定义输出。你还可以使用 "),a("code",[t._v("webpack.DefinePlugin")]),t._v(" 将revision信息传递给应用程序。在 "),a("a",{attrs:{href:"https://lvzhenbang.github.io/webpack-book/dist/zh/optimizing/03_environment_variables.html",target:"_blank",rel:"noopener noreferrer"}},[a("em",[t._v("环境变量")]),a("OutboundLink")],1),t._v(" 这一章中将详细介绍这种技术。")]),a("blockquote",[a("p",[t._v("在webpack4.x中使用这个插件，将会遇到问题，"),a("a",{attrs:{href:"https://github.com/webpack-contrib/uglifyjs-webpack-plugin/issues/222",target:"_blank",rel:"noopener noreferrer"}},[t._v("github issue"),a("OutboundLink")],1),t._v("中有详细讨论。")])]),t._m(19),t._m(20),a("p",[t._v("复制文件，是你可以使用webpack处理的另一个普通操作。如果你需要将外部数据带到你的构建中而不需要webpack直接指向它们，那么[copy-webpack-plugin]（https://www.npmjs.com/package/copy-webpack-plugin）用起来很方便。")]),a("p",[t._v("如果你想以跨平台的方式在webpack之外完成复制，那么[cpy-cli]（https://www.npmjs.com/package/cpy-cli）是一个不错的选择。")]),t._m(21),a("p",[t._v("通常，你可以通过鉴别问题，然后找到解决问题的插件，并把它用于webpack处理。在webpack之外解决这些类型的问题是完全可以接受的，但是也可以通过webpack来处理它们。")]),a("p",[t._v("内容回顾：")]),a("ul",[a("li",[t._v("你可以找到许多可用作任务的小插件，并将webpack推向任务运行器。")]),a("li",[t._v("这些任务包括清理构建和部署。"),a("a",{attrs:{href:"https://lvzhenbang.github.io/webpack-book/dist/zh/techniques/05_deploying.html",target:"_blank",rel:"noopener noreferrer"}},[a("em",[t._v("部署应用程序")]),a("OutboundLink")],1),t._v(" 这章详细讨论了后一个主题。")]),a("li",[t._v("向生产构建生成文件中添加注释信息，来来告知开发者已部署的版本，这是一个好主意。这样你就可以更快地调试潜在问题。")]),a("li",[t._v("像这样的辅助任务可以在webpack之外执行。如果您使用 "),a("a",{attrs:{href:"https://lvzhenbang.github.io/webpack-book/dist/zh/output/02_multiple_pages.html",target:"_blank",rel:"noopener noreferrer"}},[a("em",[t._v("多页构建")]),t._v("（这章详细讲解如何实现多页构建）"),a("OutboundLink")],1),t._v(",则必须使用此功能。")])])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"整理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整理","aria-hidden":"true"}},[this._v("#")]),this._v(" 整理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当前的配置不会清除多次构建之间的 "),s("em",[this._v("build")]),this._v(" 目录。因此，它随着项目的变化，不断地累积文件。针对这个问题，你应该在两次构建之间进行清理。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"清除构建目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清除构建目录","aria-hidden":"true"}},[this._v("#")]),this._v(" 清除构建目录")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可以通过使用webpack插件或在其外部的工具来解决此问题。你可以在npm脚本中触发"),s("code",[this._v("rm -rf ./build && webpack")]),this._v("或"),s("code",[this._v("rimraf ./build && webpack")]),this._v("以使其保持跨平台。一个任务运行工具也可以实现相同的目的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置-cleanwebpackplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-cleanwebpackplugin","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 "),s("code",[this._v("CleanWebpackPlugin")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),s("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" clean-webpack-plugin --save-dev\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("webpack.parts.js")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" CleanWebpackPlugin "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"clean-webpack-plugin"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("clean")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" path "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("CleanWebpackPlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("path"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("webpack.config.js")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PATHS")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  app"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("join")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"src"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  build"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("join")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"dist"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" productionConfig "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("merge")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  parts"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("clean")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token constant"}},[t._v("PATHS")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("build"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("配置做如上更改之后，"),s("code",[this._v("build")]),this._v(" 目录在构建时会保持良好和整洁。你可以通过构验证建输出并确保输出目录中没有旧文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"添加-revision-到构建中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加-revision-到构建中","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加 Revision 到构建中")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置-bannerplugin-和-gitrevisionplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-bannerplugin-和-gitrevisionplugin","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 "),s("code",[this._v("BannerPlugin")]),this._v(" 和 "),s("code",[this._v("GitRevisionPlugin")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),s("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" git-revision-webpack-plugin --save-dev\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 "),s("strong",[this._v("webpack.parts.js")]),this._v(" 中定义如下一个函数：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webpack "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"webpack"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" GitRevisionPlugin "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"git-revision-webpack-plugin"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("attachRevision")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("webpack"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BannerPlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      banner"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("GitRevisionPlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("version")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 "),s("strong",[this._v("webpack.config.js")]),this._v(" 中，引入上面创建的函数：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" productionConfig "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("merge")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  parts"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("attachRevision")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("用 "),s("code",[this._v("npm run build")]),this._v(" 脚本命令执行构建，你应该注意到构建的生成的文件头部包含像 "),s("code",[this._v("/ *这样的注释！ 0b5bb05 * /")]),this._v(" 或 "),s("code",[this._v("/ *！ v1.7.0-9-g5f82fe8 * /")]),this._v(" 这样的信息。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("代码期望你在Git存储库中使用它！否则，你得到一个 "),s("code",[this._v("fatal: Not a git repository (or any of the parent directories): .git")]),this._v(" 错误。如果你不使用Git，则可以将banner替换为其他数据。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"拷贝文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拷贝文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 拷贝文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])}],!1,null,null,null);e.options.__file="04_tidying_up.md";s.default=e.exports}}]);