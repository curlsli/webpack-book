<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Server Side Rendering | webpack surviveJS</title>
    <meta name="description" content="webpack SruriveJS">
    
    
    <link rel="preload" href="/webpack-book/dist/assets/css/styles.f641f625.css" as="style"><link rel="preload" href="/webpack-book/dist/assets/js/app.f641f625.js" as="script"><link rel="preload" href="/webpack-book/dist/assets/js/101.b1db9816.js" as="script"><link rel="prefetch" href="/webpack-book/dist/assets/js/39.23556d83.js"><link rel="prefetch" href="/webpack-book/dist/assets/css/1.styles.55ac1f3c.css"><link rel="prefetch" href="/webpack-book/dist/assets/js/1.55ac1f3c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/2.0bcfd9a6.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/3.b71846be.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/4.7c96fd7a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/5.6c3f876c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/6.cf960ab0.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/7.8aff2653.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/8.b2b0e672.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/9.23d1b6a1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/10.c89aa233.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/11.119b346d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/12.fea0caa2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/13.90135418.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/14.d7c5902b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/15.cdd8598b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/16.9feeb5a8.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/17.88a3fb5d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/18.86520a22.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/19.06aa1f0f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/20.a1ea82cc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/21.83e64e3c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/22.7ea8bd6d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/23.d68f173f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/24.c362fcbc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/25.dbe72d2b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/26.51e49fea.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/27.44b8cce2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/28.bdd8149d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/29.53f3a6a3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/30.8d53b342.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/31.54701dd5.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/32.7b95cfca.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/33.12767367.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/34.e8f937ff.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/35.0116a5ee.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/36.4577296e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/37.664aef77.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/38.905219c1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/40.3cf8f3a9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/41.5f19363b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/42.cb3f7a70.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/43.5f7005a3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/44.501e283a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/45.72772c8d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/46.8255bd88.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/47.4a55e742.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/48.05bd4e93.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/49.cb2e70c6.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/50.98dd3729.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/51.75a16507.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/52.2600380f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/53.6bc22a60.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/54.9ee44c32.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/55.0292288e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/56.ee93b099.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/57.2ac7ace9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/58.afff402a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/59.6ef84ad3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/60.90d3264b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/61.03440db3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/62.bcb571bb.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/63.4908a7ca.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/64.8e0106d7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/65.5837f196.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/66.48d46f1e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/67.9d6db054.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/68.372f2285.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/69.0951460b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/70.231bae01.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/71.3cf15c56.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/72.18273d4b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/73.64a4530c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/74.55c32af9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/75.50767dc1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/76.ac663f00.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/77.1648a6a7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/78.2f4d9a87.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/79.c5070066.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/80.a4df8a94.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/81.5955e495.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/82.451f5f9a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/83.b88550c0.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/84.c53c0eb4.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/85.cefcaebc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/86.136acab7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/87.fd12cdba.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/88.00a8eadc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/89.2f79953e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/90.14cff6a9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/91.d164cf98.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/92.5f9f33b5.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/93.255542ba.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/94.e13bca86.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/95.488dbedc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/96.5413f710.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/97.70cc2691.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/98.2f176607.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/99.443fdfb2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/100.558341ba.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/102.c6c56d0f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/103.521eafa3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/104.ffce433d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/105.76ce0f67.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/106.a15b86d2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/107.63c49e77.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/108.5dab2706.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/109.0ceece9d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/110.31b11593.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/111.3a552df9.js">
    <link rel="stylesheet" href="/webpack-book/dist/assets/css/styles.f641f625.css"><link rel="stylesheet" href="/webpack-book/dist/assets/css/1.styles.55ac1f3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/webpack-book/dist/" class="home-link router-link-active"><!----><span class="site-name">
      webpack surviveJS
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/dist/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/dist/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><div class="carbon-ads"></div><ul class="sidebar-links"><li><a href="/webpack-book/dist/" class="sidebar-link">简介</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>指南</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>开发</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>样式</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>加载静态资源</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>构建</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>优化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>输出</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/webpack-book/dist/zh/output/01_targets.html" class="sidebar-link">Build Targets</a></li><li><a href="/webpack-book/dist/zh/output/02_multiple_pages.html" class="sidebar-link">Multiple Pages</a></li><li><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html" class="active sidebar-link">Server Side Rendering</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#setting-up-babel-with-react" class="sidebar-link">Setting Up Babel with React</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#setting-up-a-react-demo" class="sidebar-link">Setting Up a React Demo</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#configuring-webpack" class="sidebar-link">Configuring Webpack</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#setting-up-a-server" class="sidebar-link">Setting Up a Server</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#watching-ssr-changes-and-refreshing-the-browser" class="sidebar-link">Watching SSR Changes and Refreshing the Browser</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#open-questions" class="sidebar-link">Open Questions</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/output/03_server_side_rendering.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>技术</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>扩展</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>附录</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="server-side-rendering"><a href="#server-side-rendering" aria-hidden="true" class="header-anchor">#</a> Server Side Rendering</h1><p><strong>Server Side Rendering</strong> (SSR) is a technique that allows you to serve an initial payload with HTML, JavaScript, CSS, and even application state. You serve a fully rendered HTML page that would make sense even without JavaScript enabled. In addition to providing potential performance benefits, this can help with Search Engine Optimization (SEO).</p><p>Even though the idea does not sound that unique, there is a technical cost. The approach was popularized by React. Since then frameworks encapsulating the tricky bits, such as <a href="https://www.npmjs.com/package/next" target="_blank" rel="noopener noreferrer">Next.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://www.npmjs.com/package/razzle" target="_blank" rel="noopener noreferrer">razzle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, have appeared.</p><p>To demonstrate SSR, you can use webpack to compile a client-side build that then gets picked up by a server that renders it using React following the principle. Doing this is enough to understand how it works and also where the problems begin.</p><p>T&gt; SSR isn't the only solution to the SEO problem. <strong>Prerendering</strong> is an alternate technique that is easier to implement if it fits your use case. The approach won't work well with highly dynamic data. <a href="https://www.npmjs.com/package/prerender-spa-plugin" target="_blank" rel="noopener noreferrer">prerender-spa-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> allows you to implement it with webpack.</p><h2 id="setting-up-babel-with-react"><a href="#setting-up-babel-with-react" aria-hidden="true" class="header-anchor">#</a> Setting Up Babel with React</h2><p>The <em>Loading JavaScript</em> chapter covers the essentials of using Babel with webpack. There's setup that is particular to React you should perform, though. Given most of React projects rely on <a href="https://facebook.github.io/jsx/" target="_blank" rel="noopener noreferrer">JSX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> format, you have to enable it through Babel.</p><p>{pagebreak}</p><p>To get React, and particularly JSX, work with Babel, install the preset first:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> @babel/preset-react --save-dev
</code></pre></div><p>Connect the preset with Babel configuration as follows:</p><p><strong>.babelrc</strong></p><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
leanpub-start-insert
    <span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">,</span>
leanpub-end-insert
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="setting-up-a-react-demo"><a href="#setting-up-a-react-demo" aria-hidden="true" class="header-anchor">#</a> Setting Up a React Demo</h2><p>To make sure the project has the dependencies in place, install React and <a href="https://www.npmjs.com/package/react-dom" target="_blank" rel="noopener noreferrer">react-dom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The latter package is needed to render the application to the DOM.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> react react-dom --save
</code></pre></div><p>Next, the React code needs a small entry point. If you are on the browser side, you should mount <code>Hello world</code><code>div</code> to the document. To prove it works, clicking it should give a dialog with a &quot;hello&quot; message. On server-side, the React component is returned and the server can pick it up.</p><p>{pagebreak}</p><p>Adjust as follows:</p><p><strong>src/ssr.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> React <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ReactDOM <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Hello world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Render only in the browser, export otherwise</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> document <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">SSR</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You are still missing webpack configuration to turn this file into something the server can pick up.</p><p>W&gt; Given ES2015 style imports and CommonJS exports cannot be mixed, the entry point was written in CommonJS style.</p><p>{pagebreak}</p><h2 id="configuring-webpack"><a href="#configuring-webpack" aria-hidden="true" class="header-anchor">#</a> Configuring Webpack</h2><p>To keep things nice, we will define a separate configuration file. A lot of the work has been done already. Given you have to consume the same output from multiple environments, using UMD as the library target makes sense:</p><p><strong>webpack.ssr.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parts <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.parts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  build<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ssrDemo<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ssr.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      index<span class="token punctuation">:</span> <span class="token constant">PATHS</span><span class="token punctuation">.</span>ssrDemo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token constant">PATHS</span><span class="token punctuation">.</span>build<span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
      libraryTarget<span class="token punctuation">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
      globalObject<span class="token punctuation">:</span> <span class="token string">&quot;this&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  parts<span class="token punctuation">.</span><span class="token function">loadJavaScript</span><span class="token punctuation">(</span><span class="token punctuation">{</span> include<span class="token punctuation">:</span> <span class="token constant">PATHS</span><span class="token punctuation">.</span>ssrDemo <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>{pagebreak}</p><p>To make it convenient to generate a build, add a helper script:</p><p><strong>package.json</strong></p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
leanpub-start-insert
  <span class="token property">&quot;build:ssr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.ssr.js&quot;</span><span class="token punctuation">,</span>
leanpub-end-insert
  ...
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>If you build the SSR demo (<code>npm run build:ssr</code>), you should see a new file at <em>./static/index.js</em>. The next step is to set up a server to render it.</p><h2 id="setting-up-a-server"><a href="#setting-up-a-server" aria-hidden="true" class="header-anchor">#</a> Setting Up a Server</h2><p>To keep things clear to understand, you can set up a standalone Express server that picks up the generated bundle and renders it following the SSR principle. Install Express first:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> express --save-dev
</code></pre></div><p>Then, to get something running, implement a server as follows:</p><p><strong>server.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-dom/server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">server</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">server</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">&quot;static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Webpack SSR Demo&lt;/title&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
    &lt;script src=&quot;./index.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Run the server now (<code>node ./server.js</code>) and go below <code>http://localhost:8080</code>, you should see something familiar:</p><p><img src="images/hello_01.png" alt="Hello world"></p><p>{pagebreak}</p><p>Even though there is a React application running now, it's difficult to develop. If you try to modify the code, nothing happens. The problem can be solved running webpack in a multi-compiler mode as earlier in this book. Another option is to run webpack in <strong>watch mode</strong> against the current configuration and set up a watcher for the server. You'll learn the setup next.</p><p>T&gt; If you want to debug output from the server, set <code>export DEBUG=express:application</code>.</p><p>T&gt; The references to the assets generated by webpack could be written automatically to the server side template if you wrote a manifest as discussed in the <em>Separating a Manifest</em> chapter.</p><h2 id="watching-ssr-changes-and-refreshing-the-browser"><a href="#watching-ssr-changes-and-refreshing-the-browser" aria-hidden="true" class="header-anchor">#</a> Watching SSR Changes and Refreshing the Browser</h2><p>The first portion of the problem is fast to solve. Run <code>npm run build:ssr -- --watch</code> in a terminal. That forces webpack to run in a watch mode. It would be possible to wrap this idea within an npm script for convenience, but this is enough for this demo.</p><p>The remaining part is harder than what was done so far. How to make the server aware of the changes and how to communicate the changes to the browser?</p><p><a href="https://www.npmjs.com/package/browser-refresh" target="_blank" rel="noopener noreferrer">browser-refresh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> can come in handy as it solves both of the problems. Install it first:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> browser-refresh --save-dev
</code></pre></div><p>{pagebreak}</p><p>The client portion requires two small changes to the server code:</p><p><strong>server.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">server</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">server</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

leanpub<span class="token operator">-</span>start<span class="token operator">-</span><span class="token keyword">delete</span>
  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
leanpub<span class="token operator">-</span>end<span class="token operator">-</span><span class="token keyword">delete</span>
leanpub<span class="token operator">-</span>start<span class="token operator">-</span>insert
  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span>send <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;online&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
leanpub<span class="token operator">-</span>end<span class="token operator">-</span>insert
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;!DOCTYPE html&gt;
&lt;html&gt;
  ...
  &lt;body&gt;
    ...
leanpub-start-insert
    &lt;script src=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BROWSER_REFRESH_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;&lt;/script&gt;
leanpub-end-insert
  &lt;/body&gt;
&lt;/html&gt;`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The first change tells the client that the application is online and ready to go. The latter change attaches the client script to the output. <em>browser-refresh</em> manages the environment variable in question.</p><p>Run <code>node_modules/.bin/browser-refresh ./server.js</code> in another terminal and open the browser at <code>http://localhost:8080</code> as earlier to test the setup. Remember to have webpack running in the watch mode at another terminal (<code>npm run build:ssr -- --watch</code>). If everything went right, any change you make to the demo client script (<em>app/ssr.js</em>) should show up in the browser or cause a failure at the server.</p><p>If the server crashes, it loses the WebSocket connection. You have to force a refresh in the browser in this case. If the server was managed through webpack as well, the problem could have been avoided.</p><p>{pagebreak}</p><p>To prove that SSR works, check out the browser inspector. You should see something familiar there:</p><p><img src="images/ssr.png" alt="SSR output"></p><p>Instead of a <code>div</code> where to mount an application, you can see all related HTML there. It's not much in this particular case, but it's enough to showcase the approach.</p><p>T&gt; The implementation could be refined further by implementing a production mode for the server that would skip injecting the browser refresh script at a minimum. The server could inject initial data payload into the generated HTML. Doing this would avoid queries on the client-side.</p><h2 id="open-questions"><a href="#open-questions" aria-hidden="true" class="header-anchor">#</a> Open Questions</h2><p>Even though the demo illustrates the basic idea of SSR, it still leaves open questions:</p><ul><li>How to deal with styles? Node doesn't understand CSS related imports.</li><li>How to deal with anything other than JavaScript? If the server side is processed through webpack, this is less of an issue as you can patch it at webpack.</li><li>How to run the server through something else other than Node? One option would be to wrap the Node instance in a service you then run through your host environment. Ideally, the results would be cached, and you can find more specific solutions for this particular per platform.</li></ul><p>Questions like these are the reason why solutions such as Next.js or razzle exist. They have been designed to solve SSR-specific problems like these.</p><p>T&gt; Routing is a big problem of its own solved by frameworks like Next.js. Patrick Hund <a href="https://ebaytech.berlin/universal-web-apps-with-react-router-4-15002bb30ccb" target="_blank" rel="noopener noreferrer">discusses how to solve it with React and React Router 4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h2><p>SSR comes with a technical challenge, and for this reason, specific solutions have appeared around it. Webpack is a good fit for SSR setups.</p><p>To recap:</p><ul><li><strong>Server Side Rendering</strong> can provide more for the browser to render initially. Instead of waiting for the JavaScript to load, you can display markup instantly.</li><li>Server Side Rendering also allows you to pass initial payload of data to the client to avoid unnecessary queries to the server.</li><li>Webpack can manage the client-side portion of the problem. It can be used to generate the server as well if a more integrated solution is required. Abstractions, such as Next.js, hide these details.</li><li>Server Side Rendering does not come without a cost, and it leads to new problems as you need better approaches for dealing with aspects, such as styling or routing. The server and the client environment differ in essential manners, so the code has to be written so that it does not rely on platform-specific features too much.</li></ul></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/lvzhenbang/webpack-book/edit/dev/docs/zh/output/03_server_side_rendering.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/webpack-book/dist/zh/output/02_multiple_pages.html" class="prev">
          Multiple Pages
        </a></span><span class="next"><a href="/webpack-book/dist/zh/techniques/01_dynamic_loading.html">
          Dynamic Loading
        </a> →
      </span></p></div><div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div></div></div>
    <script src="/webpack-book/dist/assets/js/101.b1db9816.js" defer></script><script src="/webpack-book/dist/assets/js/app.f641f625.js" defer></script>
  </body>
</html>
