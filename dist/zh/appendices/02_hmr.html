<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hot Module Replacement | webpack surviveJS</title>
    <meta name="description" content="webpack SruriveJS">
    
    
    <link rel="preload" href="/webpack-book/dist/assets/css/styles.f641f625.css" as="style"><link rel="preload" href="/webpack-book/dist/assets/js/app.f641f625.js" as="script"><link rel="preload" href="/webpack-book/dist/assets/js/60.90d3264b.js" as="script"><link rel="prefetch" href="/webpack-book/dist/assets/js/39.23556d83.js"><link rel="prefetch" href="/webpack-book/dist/assets/css/1.styles.55ac1f3c.css"><link rel="prefetch" href="/webpack-book/dist/assets/js/1.55ac1f3c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/2.0bcfd9a6.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/3.b71846be.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/4.7c96fd7a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/5.6c3f876c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/6.cf960ab0.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/7.8aff2653.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/8.b2b0e672.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/9.23d1b6a1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/10.c89aa233.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/11.119b346d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/12.fea0caa2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/13.90135418.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/14.d7c5902b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/15.cdd8598b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/16.9feeb5a8.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/17.88a3fb5d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/18.86520a22.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/19.06aa1f0f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/20.a1ea82cc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/21.83e64e3c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/22.7ea8bd6d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/23.d68f173f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/24.c362fcbc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/25.dbe72d2b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/26.51e49fea.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/27.44b8cce2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/28.bdd8149d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/29.53f3a6a3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/30.8d53b342.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/31.54701dd5.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/32.7b95cfca.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/33.12767367.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/34.e8f937ff.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/35.0116a5ee.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/36.4577296e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/37.664aef77.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/38.905219c1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/40.3cf8f3a9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/41.5f19363b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/42.cb3f7a70.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/43.5f7005a3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/44.501e283a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/45.72772c8d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/46.8255bd88.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/47.4a55e742.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/48.05bd4e93.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/49.cb2e70c6.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/50.98dd3729.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/51.75a16507.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/52.2600380f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/53.6bc22a60.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/54.9ee44c32.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/55.0292288e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/56.ee93b099.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/57.2ac7ace9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/58.afff402a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/59.6ef84ad3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/61.03440db3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/62.bcb571bb.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/63.4908a7ca.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/64.8e0106d7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/65.5837f196.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/66.48d46f1e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/67.9d6db054.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/68.372f2285.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/69.0951460b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/70.231bae01.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/71.3cf15c56.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/72.18273d4b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/73.64a4530c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/74.55c32af9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/75.50767dc1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/76.ac663f00.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/77.1648a6a7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/78.2f4d9a87.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/79.c5070066.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/80.a4df8a94.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/81.5955e495.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/82.451f5f9a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/83.b88550c0.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/84.c53c0eb4.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/85.cefcaebc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/86.136acab7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/87.fd12cdba.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/88.00a8eadc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/89.2f79953e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/90.14cff6a9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/91.d164cf98.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/92.5f9f33b5.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/93.255542ba.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/94.e13bca86.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/95.488dbedc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/96.5413f710.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/97.70cc2691.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/98.2f176607.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/99.443fdfb2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/100.558341ba.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/101.b1db9816.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/102.c6c56d0f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/103.521eafa3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/104.ffce433d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/105.76ce0f67.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/106.a15b86d2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/107.63c49e77.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/108.5dab2706.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/109.0ceece9d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/110.31b11593.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/111.3a552df9.js">
    <link rel="stylesheet" href="/webpack-book/dist/assets/css/styles.f641f625.css"><link rel="stylesheet" href="/webpack-book/dist/assets/css/1.styles.55ac1f3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/webpack-book/dist/" class="home-link router-link-active"><!----><span class="site-name">
      webpack surviveJS
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/dist/zh/appendices/02_hmr.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/dist/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/dist/zh/appendices/02_hmr.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/dist/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><div class="carbon-ads"></div><ul class="sidebar-links"><li><a href="/webpack-book/dist/" class="sidebar-link">简介</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>指南</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>开发</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>样式</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>加载静态资源</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>构建</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>优化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>输出</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>技术</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>扩展</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>附录</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/webpack-book/dist/zh/appendices/01_comparison.html" class="sidebar-link">Comparison of Build Tools</a></li><li><a href="/webpack-book/dist/zh/appendices/02_hmr.html" class="active sidebar-link">Hot Module Replacement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/appendices/02_hmr.html#enabling-hmr" class="sidebar-link">Enabling HMR</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/appendices/02_hmr.html#implementing-the-hmr-interface" class="sidebar-link">Implementing the HMR Interface</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/appendices/02_hmr.html#setting-wds-entry-points-manually" class="sidebar-link">Setting WDS Entry Points Manually</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/appendices/02_hmr.html#hmr-and-dynamic-loading" class="sidebar-link">HMR and Dynamic Loading</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/appendices/02_hmr.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li><li><a href="/webpack-book/dist/zh/appendices/03_css_modules.html" class="sidebar-link">CSS Modules</a></li><li><a href="/webpack-book/dist/zh/appendices/04_searching_with_react.html" class="sidebar-link">Searching with React</a></li><li><a href="/webpack-book/dist/zh/appendices/05_troubleshooting.html" class="sidebar-link">Troubleshooting</a></li><li><a href="/webpack-book/dist/zh/appendices/06_glossary.html" class="sidebar-link">Glossary</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="hot-module-replacement"><a href="#hot-module-replacement" aria-hidden="true" class="header-anchor">#</a> Hot Module Replacement</h1><p><strong>Hot Module Replacement</strong> (HMR) builds on top of the WDS. It enables an interface that makes it possible to swap modules live. For example, <em>style-loader</em> can update your CSS without forcing a refresh. Implementing HMR for styles is ideal because CSS is stateless by design.</p><p>HMR is possible with JavaScript too, but due to application state, it's harder. <a href="https://github.com/gaearon/react-hot-loader/" target="_blank" rel="noopener noreferrer">react-hot-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://www.npmjs.com/package/vue-hot-reload-api" target="_blank" rel="noopener noreferrer">vue-hot-reload-api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> are good examples.</p><p>T&gt; Given HMR can be complex to implement, a good compromise is to store application state to <code>localStorage</code> and then hydrate the application based on that after a refresh. Doing this pushes the problem to the application side.</p><h2 id="enabling-hmr"><a href="#enabling-hmr" aria-hidden="true" class="header-anchor">#</a> Enabling HMR</h2><p>The following steps need to be enabled for HMR to work:</p><ol><li>WDS has to run in the hot mode to expose the hot module replacement interface to the client.</li><li>Webpack has to provide hot updates to the server and can be achieved using <code>webpack.HotModuleReplacementPlugin</code>.</li><li>The client has to run specific scripts provided by the WDS. They will be injected automatically but can be enabled explicitly through entry configuration.</li><li>The client has to implement the HMR interface through <code>module.hot.accept</code>.</li></ol><p>Using <code>webpack-dev-server --hot</code> solves the first two problems. In this case, you have to handle only the last one yourself if you want to patch JavaScript application code. Skipping the <code>--hot</code> flag and going through webpack configuration gives more flexibility.</p><p>The following listing contains the essential parts related to this approach. You will have to adapt from here to match your configuration style:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Don't refresh if hot loading fails. Good while</span>
    <span class="token comment">// implementing the client interface.</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// If you want to refresh on errors too, set</span>
    <span class="token comment">// hot: true,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// Enable the plugin to let webpack communicate changes</span>
    <span class="token comment">// to WDS. --hot sets this automatically!</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>{pagebreak}</p><p>If you implement configuration like above without implementing the client interface, you will most likely end up with an error:</p><p><img src="images/no-refresh2.png" alt="No refresh"></p><p>The message tells that even though the HMR interface notified the client portion of the code of a hot update, nothing was done about it and this is something to fix next.</p><p>T&gt; The setup assumes you have enabled <code>webpack.NamedModulesPlugin()</code>. If you run webpack in <code>development</code> mode, it will be on by default.</p><p>W&gt; <em>webpack-dev-server</em> can be picky about paths. Webpack <a href="https://github.com/webpack/webpack/issues/675" target="_blank" rel="noopener noreferrer">issue #675<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> discusses the problem in more detail.</p><p>W&gt; You should <strong>not</strong> enable HMR for your production configuration. It likely works, but it makes your bundles more significant than they should be.</p><p>W&gt; If you are using Babel, configure it so that it lets webpack control module generation as otherwise, HMR logic won't work!</p><h2 id="implementing-the-hmr-interface"><a href="#implementing-the-hmr-interface" aria-hidden="true" class="header-anchor">#</a> Implementing the HMR Interface</h2><p>Webpack exposes the HMR interface through a global variable: <code>module.hot</code>. It provides updates through <code>module.hot.accept(&lt;path to watch&gt;, &lt;handler&gt;)</code> function and you need to patch the application there.</p><p>The following implementation illustrates the idea against the tutorial application:</p><p><strong>src/index.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> component <span class="token keyword">from</span> <span class="token string">&quot;./component&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> demoComponent <span class="token operator">=</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>demoComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// HMR interface</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Capture hot update</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&quot;./component&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextComponent <span class="token operator">=</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Replace old content with the hot loaded one</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>nextComponent<span class="token punctuation">,</span> demoComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    demoComponent <span class="token operator">=</span> nextComponent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you refresh the browser, try to modify <em>src/component.js</em> after this change, and alter the text to something else, you should notice that the browser does not refresh at all. Instead, it should replace the DOM node while retaining the rest of the application as is.</p><p>{pagebreak}</p><p>The image below shows possible output:</p><p><img src="images/hmr.png" alt="Patched a module successfully through HMR"></p><p>The idea is the same with styling, React, Redux, and other technologies. Sometimes you don't have to implement the interface yourself even as available tooling takes care of that for you.</p><p>T&gt; To prove that HMR retains application state, set up <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox" target="_blank" rel="noopener noreferrer">a checkbox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> based component next to the original. The <code>module.hot.accept</code> code has to evolve to capture changes to it as well.</p><p>T&gt; The <code>if(module.hot)</code> block is eliminated entirely from the production build as minifier picks it up. The <em>Minifying</em> chapter delves deeper into this topic.</p><p>{pagebreak}</p><h2 id="setting-wds-entry-points-manually"><a href="#setting-wds-entry-points-manually" aria-hidden="true" class="header-anchor">#</a> Setting WDS Entry Points Manually</h2><p>In the setup above, the WDS-related entries were injected automatically. Assuming you are using WDS through Node, you would have to set them yourself as the Node API doesn't support injecting. The example below illustrates how to achieve this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  hmr<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// Include the client code. Note host/post.</span>
    <span class="token string">&quot;webpack-dev-server/client?http://localhost:8080&quot;</span><span class="token punctuation">,</span>

    <span class="token comment">// Hot reload only when compiled successfully</span>
    <span class="token string">&quot;webpack/hot/only-dev-server&quot;</span><span class="token punctuation">,</span>

    <span class="token comment">// Alternative with refresh on failure</span>
    <span class="token comment">// &quot;webpack/hot/dev-server&quot;,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="hmr-and-dynamic-loading"><a href="#hmr-and-dynamic-loading" aria-hidden="true" class="header-anchor">#</a> HMR and Dynamic Loading</h2><p><em>Dynamic Loading</em> through <code>require.context</code> and HMR requires extra effort:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> req <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&quot;./pages&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/^(.*\.(jsx$))[^.]*$/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Replace modules here as above</span>
</code></pre></div><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h2><p>HMR is one of those aspects of webpack that makes it attractive for developers and webpack has taken its implementation far. To work, HMR requires both client and server side support. For this purpose, webpack-dev-server provides both. Often you have to implement the client side interface although loaders like <em>style-loader</em> implement it for you.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/lvzhenbang/webpack-book/edit/dev/docs/zh/appendices/02_hmr.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/webpack-book/dist/zh/appendices/01_comparison.html" class="prev">
          Comparison of Build Tools
        </a></span><span class="next"><a href="/webpack-book/dist/zh/appendices/03_css_modules.html">
          CSS Modules
        </a> →
      </span></p></div><div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div></div></div>
    <script src="/webpack-book/dist/assets/js/60.90d3264b.js" defer></script><script src="/webpack-book/dist/assets/js/app.f641f625.js" defer></script>
  </body>
</html>
