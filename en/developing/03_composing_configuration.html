<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Composing Configuration | webpack surviveJS</title>
    <meta name="description" content="webpack SruriveJS">
    
    
    <link rel="preload" href="/webpack-book/assets/css/styles.7c920287.css" as="style"><link rel="preload" href="/webpack-book/assets/js/app.7c920287.js" as="script"><link rel="preload" href="/webpack-book/assets/js/16.a1674f2e.js" as="script"><link rel="prefetch" href="/webpack-book/assets/js/39.4de3484e.js"><link rel="prefetch" href="/webpack-book/assets/css/1.styles.45cc87d3.css"><link rel="prefetch" href="/webpack-book/assets/js/1.45cc87d3.js"><link rel="prefetch" href="/webpack-book/assets/js/2.4a0e8edb.js"><link rel="prefetch" href="/webpack-book/assets/js/3.4c05f671.js"><link rel="prefetch" href="/webpack-book/assets/js/4.c2f23639.js"><link rel="prefetch" href="/webpack-book/assets/js/5.571affc0.js"><link rel="prefetch" href="/webpack-book/assets/js/6.3ddb0710.js"><link rel="prefetch" href="/webpack-book/assets/js/7.13be0be2.js"><link rel="prefetch" href="/webpack-book/assets/js/8.ab685c7d.js"><link rel="prefetch" href="/webpack-book/assets/js/9.4ec307e6.js"><link rel="prefetch" href="/webpack-book/assets/js/10.ce93540e.js"><link rel="prefetch" href="/webpack-book/assets/js/11.d07f2433.js"><link rel="prefetch" href="/webpack-book/assets/js/12.78921a69.js"><link rel="prefetch" href="/webpack-book/assets/js/13.3af73d6e.js"><link rel="prefetch" href="/webpack-book/assets/js/14.51d8e1c3.js"><link rel="prefetch" href="/webpack-book/assets/js/15.2478f68d.js"><link rel="prefetch" href="/webpack-book/assets/js/17.08cb5d47.js"><link rel="prefetch" href="/webpack-book/assets/js/18.63a9d4ee.js"><link rel="prefetch" href="/webpack-book/assets/js/19.6ec78de6.js"><link rel="prefetch" href="/webpack-book/assets/js/20.448e928e.js"><link rel="prefetch" href="/webpack-book/assets/js/21.8aed75ba.js"><link rel="prefetch" href="/webpack-book/assets/js/22.442c5d65.js"><link rel="prefetch" href="/webpack-book/assets/js/23.ecb39720.js"><link rel="prefetch" href="/webpack-book/assets/js/24.f53b1026.js"><link rel="prefetch" href="/webpack-book/assets/js/25.91fac79b.js"><link rel="prefetch" href="/webpack-book/assets/js/26.f65132e8.js"><link rel="prefetch" href="/webpack-book/assets/js/27.78edbc75.js"><link rel="prefetch" href="/webpack-book/assets/js/28.7030a8db.js"><link rel="prefetch" href="/webpack-book/assets/js/29.c6fc4663.js"><link rel="prefetch" href="/webpack-book/assets/js/30.2cb421b5.js"><link rel="prefetch" href="/webpack-book/assets/js/31.575d8f9a.js"><link rel="prefetch" href="/webpack-book/assets/js/32.589855e2.js"><link rel="prefetch" href="/webpack-book/assets/js/33.bcbf13b9.js"><link rel="prefetch" href="/webpack-book/assets/js/34.0901960e.js"><link rel="prefetch" href="/webpack-book/assets/js/35.77530cbe.js"><link rel="prefetch" href="/webpack-book/assets/js/36.6ca51425.js"><link rel="prefetch" href="/webpack-book/assets/js/37.e4f9173d.js"><link rel="prefetch" href="/webpack-book/assets/js/38.711f68a2.js"><link rel="prefetch" href="/webpack-book/assets/js/40.93ecfec2.js"><link rel="prefetch" href="/webpack-book/assets/js/41.207dedbe.js"><link rel="prefetch" href="/webpack-book/assets/js/42.13655fff.js"><link rel="prefetch" href="/webpack-book/assets/js/43.0a66033e.js"><link rel="prefetch" href="/webpack-book/assets/js/44.2e0f0bc1.js"><link rel="prefetch" href="/webpack-book/assets/js/45.54abe411.js"><link rel="prefetch" href="/webpack-book/assets/js/46.a1abb589.js"><link rel="prefetch" href="/webpack-book/assets/js/47.67a5f48f.js"><link rel="prefetch" href="/webpack-book/assets/js/48.2ae652cf.js"><link rel="prefetch" href="/webpack-book/assets/js/49.c809ea19.js"><link rel="prefetch" href="/webpack-book/assets/js/50.cb0ab30d.js"><link rel="prefetch" href="/webpack-book/assets/js/51.61c5bb22.js"><link rel="prefetch" href="/webpack-book/assets/js/52.9418d1bd.js"><link rel="prefetch" href="/webpack-book/assets/js/53.8fb3b3af.js"><link rel="prefetch" href="/webpack-book/assets/js/54.c7b017c1.js"><link rel="prefetch" href="/webpack-book/assets/js/55.11cdb808.js"><link rel="prefetch" href="/webpack-book/assets/js/56.d30a62d6.js"><link rel="prefetch" href="/webpack-book/assets/js/57.80db98c6.js"><link rel="prefetch" href="/webpack-book/assets/js/58.170008c8.js"><link rel="prefetch" href="/webpack-book/assets/js/59.b8d33f82.js"><link rel="prefetch" href="/webpack-book/assets/js/60.bad2a4c0.js"><link rel="prefetch" href="/webpack-book/assets/js/61.8502ded7.js"><link rel="prefetch" href="/webpack-book/assets/js/62.2388773f.js"><link rel="prefetch" href="/webpack-book/assets/js/63.fd2ae4b4.js"><link rel="prefetch" href="/webpack-book/assets/js/64.e4a18972.js"><link rel="prefetch" href="/webpack-book/assets/js/65.1c6f2207.js"><link rel="prefetch" href="/webpack-book/assets/js/66.5ba4de03.js"><link rel="prefetch" href="/webpack-book/assets/js/67.6e5a522b.js"><link rel="prefetch" href="/webpack-book/assets/js/68.c3000811.js"><link rel="prefetch" href="/webpack-book/assets/js/69.df6a6b01.js"><link rel="prefetch" href="/webpack-book/assets/js/70.1e6f5177.js"><link rel="prefetch" href="/webpack-book/assets/js/71.9a00df76.js"><link rel="prefetch" href="/webpack-book/assets/js/72.ea1b395f.js"><link rel="prefetch" href="/webpack-book/assets/js/73.c8734858.js"><link rel="prefetch" href="/webpack-book/assets/js/74.24597070.js"><link rel="prefetch" href="/webpack-book/assets/js/75.b38bb75c.js"><link rel="prefetch" href="/webpack-book/assets/js/76.64d5107c.js"><link rel="prefetch" href="/webpack-book/assets/js/77.17ce9bc3.js"><link rel="prefetch" href="/webpack-book/assets/js/78.c1d50222.js"><link rel="prefetch" href="/webpack-book/assets/js/79.42c031ab.js"><link rel="prefetch" href="/webpack-book/assets/js/80.c83603fe.js"><link rel="prefetch" href="/webpack-book/assets/js/81.9dca7a45.js"><link rel="prefetch" href="/webpack-book/assets/js/82.bea2f876.js"><link rel="prefetch" href="/webpack-book/assets/js/83.5277ed35.js"><link rel="prefetch" href="/webpack-book/assets/js/84.9c43366f.js"><link rel="prefetch" href="/webpack-book/assets/js/85.2c3ed690.js"><link rel="prefetch" href="/webpack-book/assets/js/86.6ae8c813.js"><link rel="prefetch" href="/webpack-book/assets/js/87.790cef71.js"><link rel="prefetch" href="/webpack-book/assets/js/88.050a6bb5.js"><link rel="prefetch" href="/webpack-book/assets/js/89.a3623978.js"><link rel="prefetch" href="/webpack-book/assets/js/90.d72c8f89.js"><link rel="prefetch" href="/webpack-book/assets/js/91.b4c756d6.js"><link rel="prefetch" href="/webpack-book/assets/js/92.6bc2617e.js"><link rel="prefetch" href="/webpack-book/assets/js/93.a98fa457.js"><link rel="prefetch" href="/webpack-book/assets/js/94.0019b06c.js"><link rel="prefetch" href="/webpack-book/assets/js/95.b0536de7.js"><link rel="prefetch" href="/webpack-book/assets/js/96.c59f2491.js"><link rel="prefetch" href="/webpack-book/assets/js/97.2d03b96a.js"><link rel="prefetch" href="/webpack-book/assets/js/98.21a8c66a.js"><link rel="prefetch" href="/webpack-book/assets/js/99.4227e9fd.js"><link rel="prefetch" href="/webpack-book/assets/js/100.7675d309.js"><link rel="prefetch" href="/webpack-book/assets/js/101.712b7dfe.js"><link rel="prefetch" href="/webpack-book/assets/js/102.5df744a8.js"><link rel="prefetch" href="/webpack-book/assets/js/103.0ce8a887.js"><link rel="prefetch" href="/webpack-book/assets/js/104.cd37b677.js"><link rel="prefetch" href="/webpack-book/assets/js/105.26a54f8e.js"><link rel="prefetch" href="/webpack-book/assets/js/106.fd8b2560.js"><link rel="prefetch" href="/webpack-book/assets/js/107.67a9bbb3.js"><link rel="prefetch" href="/webpack-book/assets/js/108.a0674454.js"><link rel="prefetch" href="/webpack-book/assets/js/109.5bcd330f.js"><link rel="prefetch" href="/webpack-book/assets/js/110.832d1487.js"><link rel="prefetch" href="/webpack-book/assets/js/111.76840d88.js">
    <link rel="stylesheet" href="/webpack-book/assets/css/styles.7c920287.css"><link rel="stylesheet" href="/webpack-book/assets/css/1.styles.45cc87d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/webpack-book/en/" class="home-link router-link-active"><!----><span class="site-name">
      webpack surviveJS
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/en/developing/03_composing_configuration.html" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/en/developing/03_composing_configuration.html" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/webpack-book/en/" class="sidebar-link">webpack Book</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>guide</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>developing</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/webpack-book/en/developing/01_getting_started.html" class="sidebar-link">Getting Started</a></li><li><a href="/webpack-book/en/developing/02_webpack_dev_server.html" class="sidebar-link">webpack-dev-server</a></li><li><a href="/webpack-book/en/developing/03_composing_configuration.html" class="active sidebar-link">Composing Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-book/en/developing/03_composing_configuration.html#possible-ways-to-manage-configuration" class="sidebar-link">Possible Ways to Manage Configuration</a></li><li class="sidebar-sub-header"><a href="/webpack-book/en/developing/03_composing_configuration.html#composing-configuration-by-merging" class="sidebar-link">Composing Configuration by Merging</a></li><li class="sidebar-sub-header"><a href="/webpack-book/en/developing/03_composing_configuration.html#setting-up-webpack-merge" class="sidebar-link">Setting Up webpack-merge</a></li><li class="sidebar-sub-header"><a href="/webpack-book/en/developing/03_composing_configuration.html#benefits-of-composing-configuration" class="sidebar-link">Benefits of Composing Configuration</a></li><li class="sidebar-sub-header"><a href="/webpack-book/en/developing/03_composing_configuration.html#configuration-layouts" class="sidebar-link">Configuration Layouts</a></li><li class="sidebar-sub-header"><a href="/webpack-book/en/developing/03_composing_configuration.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>styling</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>loading Assets</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>building</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>optimizing</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>output</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>techniques</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>extending</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>appendices</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="composing-configuration"><a href="#composing-configuration" aria-hidden="true" class="header-anchor">#</a> Composing Configuration</h1><p>Even though not a lot has been done with webpack yet, the amount of configuration is starting to feel substantial. Now you have to be careful about the way you compose it as you have separate production and development targets in the project. The situation can only get worse as you want to add more functionality to the project.</p><p>Using a single monolithic configuration file impacts comprehension and removes any potential for reusability. As the needs of your project grow, you have to figure out the means to manage webpack configuration more effectively.</p><h2 id="possible-ways-to-manage-configuration"><a href="#possible-ways-to-manage-configuration" aria-hidden="true" class="header-anchor">#</a> Possible Ways to Manage Configuration</h2><p>You can manage webpack configuration in the following ways:</p><ul><li>Maintain configuration within multiple files for each environment and point webpack to each through the <code>--config</code> parameter, sharing configuration through module imports.</li><li>Push configuration to a library, which you then consume. Examples: <a href="https://www.npmjs.com/package/hjs-webpack" target="_blank" rel="noopener noreferrer">hjs-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://neutrino.js.org/" target="_blank" rel="noopener noreferrer">Neutrino<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://www.npmjs.com/package/webpack-blocks" target="_blank" rel="noopener noreferrer">webpack-blocks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li><li>Push configuration to a tool. Examples: <a href="https://www.npmjs.com/package/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://www.npmjs.com/package/kyt" target="_blank" rel="noopener noreferrer">kyt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://www.npmjs.com/package/nwb" target="_blank" rel="noopener noreferrer">nwb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li><li>Maintain all configuration within a single file and branch there and rely on the <code>--env</code> parameter. The approach is explained in detail later in this chapter.</li></ul><p>These approaches can be combined to create a higher level configuration that is then composed of smaller parts. Those parts could then be added to a library which you then use through npm making it possible to consume the same configuration across multiple projects.</p><h2 id="composing-configuration-by-merging"><a href="#composing-configuration-by-merging" aria-hidden="true" class="header-anchor">#</a> Composing Configuration by Merging</h2><p>If the configuration file is broken into separate pieces, they have to be combined again somehow. Normally this means merging objects and arrays. To eliminate the problem of dealing with <code>Object.assign</code> and <code>Array.concat</code>, <a href="https://www.npmjs.org/package/webpack-merge" target="_blank" rel="noopener noreferrer">webpack-merge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> was developed.</p><p><em>webpack-merge</em> does two things: it concatenates arrays and merges objects instead of overriding them allowing composition. The example below shows the behavior in detail:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> merge <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">..</span>.
<span class="token operator">&gt;</span> merge<span class="token punctuation">(</span>
<span class="token punctuation">..</span>. <span class="token punctuation">{</span> a: <span class="token punctuation">[</span>1<span class="token punctuation">]</span>, b: 5, c: 20 <span class="token punctuation">}</span>,
<span class="token punctuation">..</span>. <span class="token punctuation">{</span> a: <span class="token punctuation">[</span>2<span class="token punctuation">]</span>, b: 10, d: 421 <span class="token punctuation">}</span>
<span class="token punctuation">..</span>. <span class="token punctuation">)</span>
<span class="token punctuation">{</span> a: <span class="token punctuation">[</span> 1, 2 <span class="token punctuation">]</span>, b: 10, c: 20, d: 421 <span class="token punctuation">}</span>
</code></pre></div><p><em>webpack-merge</em> provides even more control through strategies that enable you to control its behavior per field. They allow you to force it to append, prepend, or replace content.</p><p>Even though <em>webpack-merge</em> was designed for this book, it has proven to be an invaluable tool beyond it. You can consider it as a learning tool and pick it up in your work if you find it handy.</p><p>T&gt; <a href="https://www.npmjs.com/package/webpack-chain" target="_blank" rel="noopener noreferrer">webpack-chain<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> provides a fluent API for configuring webpack allowing you to avoid configuration shape-related problems while enabling composition.</p><p>{pagebreak}</p><h2 id="setting-up-webpack-merge"><a href="#setting-up-webpack-merge" aria-hidden="true" class="header-anchor">#</a> Setting Up <em>webpack-merge</em></h2><p>To get started, add <em>webpack-merge</em> to the project:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webpack-merge --save-dev
</code></pre></div><p>To give a degree of abstraction, you can define <em>webpack.config.js</em> for higher level configuration and <em>webpack.parts.js</em> for configuration parts to consume. Here are the parts with small function-based interfaces extracted from the existing code:</p><p><strong>webpack.parts.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">devServer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> host<span class="token punctuation">,</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    stats<span class="token punctuation">:</span> <span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">,</span> <span class="token comment">// Defaults to `localhost`</span>
    port<span class="token punctuation">,</span> <span class="token comment">// Defaults to 8080</span>
    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    overlay<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>T&gt; The same <code>stats</code> idea works for production configuration as well. See <a href="https://webpack.js.org/configuration/stats/" target="_blank" rel="noopener noreferrer">the official documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for all the available options.</p><p>{pagebreak}</p><p>To connect this configuration part, set up <em>webpack.config.js</em> as in the code example below:</p><p><strong>webpack.config.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parts <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.parts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&quot;Webpack demo&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> productionConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> developmentConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  parts<span class="token punctuation">.</span><span class="token function">devServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// Customize host/port here if needed</span>
    host<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">HOST</span><span class="token punctuation">,</span>
    port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> mode <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> productionConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> developmentConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Instead of returning a configuration directly, a function capturing the passed <code>env</code> is returned. The function returns configuration based on it and also maps webpack <code>mode</code> to it. Doing this means <em>package.json</em> needs a modification:</p><p><strong>package.json</strong></p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
leanpub-start-insert
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --env development&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env production&quot;</span>
leanpub-end-insert
leanpub-start-delete
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --mode development&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode production&quot;</span>
leanpub-end-delete
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>After these changes, the build should behave the same way as before. This time, however, you have room to expand, and you don't have to worry about how to combine different parts of the configuration.</p><p>You can add more targets by expanding the <em>package.json</em> definition and branching at <em>webpack.config.js</em> based on the need. <em>webpack.parts.js</em> grows to contain specific techniques you can then use to compose the configuration.</p><p>T&gt; <code>productionConfig</code> is a stub for now and it will grow later as we expand the configuration further.</p><p>T&gt; The <a href="https://nodejs.org/api/process.html" target="_blank" rel="noopener noreferrer">process<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> module used in the code is exposed by Node as a global. In addition to <code>env</code>, it provides plenty of other functionality that allows you to get more information of the host system.</p><p>{pagebreak}</p><h3 id="understanding-env"><a href="#understanding-env" aria-hidden="true" class="header-anchor">#</a> Understanding <code>--env</code></h3><p>Even though <code>--env</code> allows to pass strings to the configuration, it can do a bit more. Consider the following example:</p><p><strong>package.json</strong></p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --env development&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env.target production&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>Instead of a string, you should receive an object <code>{ target: &quot;production&quot; }</code> at configuration now. You could pass more key-value pairs, and they would go to the <code>env</code> object. If you set <code>--env foo</code> while setting <code>--env.target</code>, the string wins. Webpack relies on <a href="http://yargs.js.org/docs/#parsing-tricks-dot-notation" target="_blank" rel="noopener noreferrer">yargs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for parsing underneath.</p><h2 id="benefits-of-composing-configuration"><a href="#benefits-of-composing-configuration" aria-hidden="true" class="header-anchor">#</a> Benefits of Composing Configuration</h2><p>Configuration splitting allows you to keep on expanding the setup. The most significant win is the fact that you can extract commonalities between different targets. You can also identify smaller configuration parts to compose. These configuration parts can be pushed to packages of their own to consume across projects.</p><p>Instead of duplicating similar configuration across multiple projects, you can manage configuration as a dependency now. As you figure out better ways to perform tasks, all your projects receive the improvements.</p><p>Each approach comes with its pros and cons. The composition-based approach is a good starting point. In addition to composition, it gives you a limited amount of code to scan through, but it's a good idea to check out how other people do it too. You can find something that works the best based on your tastes.</p><p>Perhaps the biggest problem is that with composition you need to know what you are doing, and it's possible you aren't going to get the composition right the first time around. But that's a software engineering problem that goes beyond webpack.</p><p>You can always iterate on the interfaces and find better ones. By passing in a configuration object instead of multiple arguments you can change the behavior of a part without affecting its API, effectively exposing the API as you need it.</p><h2 id="configuration-layouts"><a href="#configuration-layouts" aria-hidden="true" class="header-anchor">#</a> Configuration Layouts</h2><p>In the book project, you will push all of the configuration into two files: <em>webpack.config.js</em> and <em>webpack.parts.js</em>. The former contains higher level configuration while the lower level isolates you from webpack specifics. The chosen approach allows more file layouts than the one we have.</p><h3 id="split-per-configuration-target"><a href="#split-per-configuration-target" aria-hidden="true" class="header-anchor">#</a> Split per Configuration Target</h3><p>If you split the configuration per target, you could end up with a file structure as below:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
└── config
    ├── webpack.common.js
    ├── webpack.development.js
    ├── webpack.parts.js
    └── webpack.production.js
</code></pre></div><p>In this case, you would point to the targets through webpack <code>--config</code> parameter and <code>merge</code> common configuration through <code>module.exports = merge(common, config);</code>.</p><p>{pagebreak}</p><h3 id="split-parts-per-purpose"><a href="#split-parts-per-purpose" aria-hidden="true" class="header-anchor">#</a> Split Parts per Purpose</h3><p>To add hierarchy to the way configuration parts are managed, you could decompose <em>webpack.parts.js</em> per category:</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
└── config
    ├── parts
    │   ├── devserver.js
    <span class="token punctuation">..</span>.
    │   ├── index.js
    │   └── javascript.js
    └── <span class="token punctuation">..</span>.
</code></pre></div><p>This arrangement would make it faster to find configuration related to a category. A good option would be to arrange the parts within a single file and use comments to split it up.</p><h3 id="pushing-parts-to-packages"><a href="#pushing-parts-to-packages" aria-hidden="true" class="header-anchor">#</a> Pushing Parts to Packages</h3><p>Given all configuration is JavaScript, nothing prevents you from consuming it as a package or packages. It would be possible to package the shared configuration so that you can consume it across multiple projects. See the <a href="https://survivejs.com/maintenance/" target="_blank" rel="noopener noreferrer">SurviveJS - Maintenance<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> book for further information on how to achieve this.</p><p>{pagebreak}</p><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h2><p>Even though the configuration is technically the same as before, now you have room to grow it.</p><p>To recap:</p><ul><li>Given webpack configuration is JavaScript code underneath, there are many ways to manage it.</li><li>You should choose a method to compose configuration that makes the most sense to you. <a href="https://www.npmjs.com/package/webpack-merge" target="_blank" rel="noopener noreferrer">webpack-merge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> was developed to provide a light approach for composition, but you can find many other options in the wild.</li><li>Webpack's <code>--env</code> parameter allows you to control configuration target through terminal. You receive the passed <code>env</code> through a function interface.</li><li>Composition can enable configuration sharing. Instead of having to maintain a custom configuration per repository, you can share it across repositories this way. Using npm packages allows this. Developing configuration is close to developing any other code. This time, however, you codify your practices as packages.</li></ul><p>The next parts of this book cover different techniques, and <em>webpack.parts.js</em> sees a lot of action as a result. The changes to <em>webpack.config.js</em>, fortunately, remain minimal.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/lvzhenbang/webpack-book/edit/dev/docs/en/developing/03_composing_configuration.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/webpack-book/en/developing/02_webpack_dev_server.html" class="prev">
          webpack-dev-server
        </a></span><span class="next"><a href="/webpack-book/en/styling/01_loading.html">
          Loading Styles
        </a> →
      </span></p></div></div></div></div>
    <script src="/webpack-book/assets/js/16.a1674f2e.js" defer></script><script src="/webpack-book/assets/js/app.7c920287.js" defer></script>
  </body>
</html>
