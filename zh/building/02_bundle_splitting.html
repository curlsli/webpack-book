<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>构建拆分 | webpack surviveJS</title>
    <meta name="description" content="webpack SruriveJS">
    
    
    <link rel="preload" href="/webpack-book/assets/css/styles.7213af14.css" as="style"><link rel="preload" href="/webpack-book/assets/js/app.7213af14.js" as="script"><link rel="preload" href="/webpack-book/assets/js/66.5ba4de03.js" as="script"><link rel="prefetch" href="/webpack-book/assets/js/39.4de3484e.js"><link rel="prefetch" href="/webpack-book/assets/css/1.styles.45cc87d3.css"><link rel="prefetch" href="/webpack-book/assets/js/1.45cc87d3.js"><link rel="prefetch" href="/webpack-book/assets/js/2.4a0e8edb.js"><link rel="prefetch" href="/webpack-book/assets/js/3.4c05f671.js"><link rel="prefetch" href="/webpack-book/assets/js/4.c00bb4bb.js"><link rel="prefetch" href="/webpack-book/assets/js/5.6026fd36.js"><link rel="prefetch" href="/webpack-book/assets/js/6.3ddb0710.js"><link rel="prefetch" href="/webpack-book/assets/js/7.13be0be2.js"><link rel="prefetch" href="/webpack-book/assets/js/8.ab685c7d.js"><link rel="prefetch" href="/webpack-book/assets/js/9.4ec307e6.js"><link rel="prefetch" href="/webpack-book/assets/js/10.ce93540e.js"><link rel="prefetch" href="/webpack-book/assets/js/11.d07f2433.js"><link rel="prefetch" href="/webpack-book/assets/js/12.78921a69.js"><link rel="prefetch" href="/webpack-book/assets/js/13.3af73d6e.js"><link rel="prefetch" href="/webpack-book/assets/js/14.51d8e1c3.js"><link rel="prefetch" href="/webpack-book/assets/js/15.2478f68d.js"><link rel="prefetch" href="/webpack-book/assets/js/16.a1674f2e.js"><link rel="prefetch" href="/webpack-book/assets/js/17.08cb5d47.js"><link rel="prefetch" href="/webpack-book/assets/js/18.63a9d4ee.js"><link rel="prefetch" href="/webpack-book/assets/js/19.6ec78de6.js"><link rel="prefetch" href="/webpack-book/assets/js/20.448e928e.js"><link rel="prefetch" href="/webpack-book/assets/js/21.8aed75ba.js"><link rel="prefetch" href="/webpack-book/assets/js/22.442c5d65.js"><link rel="prefetch" href="/webpack-book/assets/js/23.ecb39720.js"><link rel="prefetch" href="/webpack-book/assets/js/24.f53b1026.js"><link rel="prefetch" href="/webpack-book/assets/js/25.91fac79b.js"><link rel="prefetch" href="/webpack-book/assets/js/26.f65132e8.js"><link rel="prefetch" href="/webpack-book/assets/js/27.78edbc75.js"><link rel="prefetch" href="/webpack-book/assets/js/28.7030a8db.js"><link rel="prefetch" href="/webpack-book/assets/js/29.c6fc4663.js"><link rel="prefetch" href="/webpack-book/assets/js/30.2cb421b5.js"><link rel="prefetch" href="/webpack-book/assets/js/31.575d8f9a.js"><link rel="prefetch" href="/webpack-book/assets/js/32.589855e2.js"><link rel="prefetch" href="/webpack-book/assets/js/33.bcbf13b9.js"><link rel="prefetch" href="/webpack-book/assets/js/34.0901960e.js"><link rel="prefetch" href="/webpack-book/assets/js/35.77530cbe.js"><link rel="prefetch" href="/webpack-book/assets/js/36.6ca51425.js"><link rel="prefetch" href="/webpack-book/assets/js/37.e4f9173d.js"><link rel="prefetch" href="/webpack-book/assets/js/38.711f68a2.js"><link rel="prefetch" href="/webpack-book/assets/js/40.93ecfec2.js"><link rel="prefetch" href="/webpack-book/assets/js/41.207dedbe.js"><link rel="prefetch" href="/webpack-book/assets/js/42.7e2cbeb1.js"><link rel="prefetch" href="/webpack-book/assets/js/43.0a66033e.js"><link rel="prefetch" href="/webpack-book/assets/js/44.2e0f0bc1.js"><link rel="prefetch" href="/webpack-book/assets/js/45.7897a16a.js"><link rel="prefetch" href="/webpack-book/assets/js/46.573f427b.js"><link rel="prefetch" href="/webpack-book/assets/js/47.5a6cf832.js"><link rel="prefetch" href="/webpack-book/assets/js/48.2ae652cf.js"><link rel="prefetch" href="/webpack-book/assets/js/49.c1decf35.js"><link rel="prefetch" href="/webpack-book/assets/js/50.cb0ab30d.js"><link rel="prefetch" href="/webpack-book/assets/js/51.61c5bb22.js"><link rel="prefetch" href="/webpack-book/assets/js/52.9418d1bd.js"><link rel="prefetch" href="/webpack-book/assets/js/53.8fb3b3af.js"><link rel="prefetch" href="/webpack-book/assets/js/54.0b373f02.js"><link rel="prefetch" href="/webpack-book/assets/js/55.11cdb808.js"><link rel="prefetch" href="/webpack-book/assets/js/56.d30a62d6.js"><link rel="prefetch" href="/webpack-book/assets/js/57.80db98c6.js"><link rel="prefetch" href="/webpack-book/assets/js/58.170008c8.js"><link rel="prefetch" href="/webpack-book/assets/js/59.b8d33f82.js"><link rel="prefetch" href="/webpack-book/assets/js/60.bad2a4c0.js"><link rel="prefetch" href="/webpack-book/assets/js/61.8502ded7.js"><link rel="prefetch" href="/webpack-book/assets/js/62.2388773f.js"><link rel="prefetch" href="/webpack-book/assets/js/63.fd2ae4b4.js"><link rel="prefetch" href="/webpack-book/assets/js/64.e4a18972.js"><link rel="prefetch" href="/webpack-book/assets/js/65.1c6f2207.js"><link rel="prefetch" href="/webpack-book/assets/js/67.6e5a522b.js"><link rel="prefetch" href="/webpack-book/assets/js/68.c3000811.js"><link rel="prefetch" href="/webpack-book/assets/js/69.df6a6b01.js"><link rel="prefetch" href="/webpack-book/assets/js/70.1e6f5177.js"><link rel="prefetch" href="/webpack-book/assets/js/71.9a00df76.js"><link rel="prefetch" href="/webpack-book/assets/js/72.ea1b395f.js"><link rel="prefetch" href="/webpack-book/assets/js/73.c8734858.js"><link rel="prefetch" href="/webpack-book/assets/js/74.24597070.js"><link rel="prefetch" href="/webpack-book/assets/js/75.b38bb75c.js"><link rel="prefetch" href="/webpack-book/assets/js/76.64d5107c.js"><link rel="prefetch" href="/webpack-book/assets/js/77.17ce9bc3.js"><link rel="prefetch" href="/webpack-book/assets/js/78.c1d50222.js"><link rel="prefetch" href="/webpack-book/assets/js/79.42c031ab.js"><link rel="prefetch" href="/webpack-book/assets/js/80.c83603fe.js"><link rel="prefetch" href="/webpack-book/assets/js/81.9dca7a45.js"><link rel="prefetch" href="/webpack-book/assets/js/82.bea2f876.js"><link rel="prefetch" href="/webpack-book/assets/js/83.5277ed35.js"><link rel="prefetch" href="/webpack-book/assets/js/84.9c43366f.js"><link rel="prefetch" href="/webpack-book/assets/js/85.2c3ed690.js"><link rel="prefetch" href="/webpack-book/assets/js/86.6ae8c813.js"><link rel="prefetch" href="/webpack-book/assets/js/87.790cef71.js"><link rel="prefetch" href="/webpack-book/assets/js/88.050a6bb5.js"><link rel="prefetch" href="/webpack-book/assets/js/89.a3623978.js"><link rel="prefetch" href="/webpack-book/assets/js/90.d72c8f89.js"><link rel="prefetch" href="/webpack-book/assets/js/91.b4c756d6.js"><link rel="prefetch" href="/webpack-book/assets/js/92.6bc2617e.js"><link rel="prefetch" href="/webpack-book/assets/js/93.a98fa457.js"><link rel="prefetch" href="/webpack-book/assets/js/94.0019b06c.js"><link rel="prefetch" href="/webpack-book/assets/js/95.b0536de7.js"><link rel="prefetch" href="/webpack-book/assets/js/96.fb10cc59.js"><link rel="prefetch" href="/webpack-book/assets/js/97.c833f49f.js"><link rel="prefetch" href="/webpack-book/assets/js/98.6d8bae1f.js"><link rel="prefetch" href="/webpack-book/assets/js/99.4227e9fd.js"><link rel="prefetch" href="/webpack-book/assets/js/100.43748c66.js"><link rel="prefetch" href="/webpack-book/assets/js/101.7308ef4d.js"><link rel="prefetch" href="/webpack-book/assets/js/102.28698397.js"><link rel="prefetch" href="/webpack-book/assets/js/103.0ce8a887.js"><link rel="prefetch" href="/webpack-book/assets/js/104.3c76608e.js"><link rel="prefetch" href="/webpack-book/assets/js/105.26a54f8e.js"><link rel="prefetch" href="/webpack-book/assets/js/106.fd8b2560.js"><link rel="prefetch" href="/webpack-book/assets/js/107.67a9bbb3.js"><link rel="prefetch" href="/webpack-book/assets/js/108.a0674454.js"><link rel="prefetch" href="/webpack-book/assets/js/109.d32767db.js"><link rel="prefetch" href="/webpack-book/assets/js/110.832d1487.js"><link rel="prefetch" href="/webpack-book/assets/js/111.76840d88.js">
    <link rel="stylesheet" href="/webpack-book/assets/css/styles.7213af14.css"><link rel="stylesheet" href="/webpack-book/assets/css/1.styles.45cc87d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/webpack-book/" class="home-link router-link-active"><!----><span class="site-name">
      webpack surviveJS
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/zh/building/02_bundle_splitting.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/zh/building/02_bundle_splitting.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/webpack-book/" class="sidebar-link">简介</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>指南</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>开发</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>样式</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>加载静态资源</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>构建</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/webpack-book/zh/building/01_source_maps.html" class="sidebar-link">Source Maps</a></li><li><a href="/webpack-book/zh/building/02_bundle_splitting.html" class="active sidebar-link">构建拆分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#构建拆分的原理" class="sidebar-link">构建拆分的原理</a></li><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#为了实现分离，引入其它依赖" class="sidebar-link">为了实现分离，引入其它依赖</a></li><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#配置-vendor-输出" class="sidebar-link">配置 vendor 输出</a></li><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#构建拆分的操作" class="sidebar-link">构建拆分的操作</a></li><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#拆分和合并模块（chunks）" class="sidebar-link">拆分和合并模块（Chunks）</a></li><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#webpack中的模块（chunk）类型" class="sidebar-link">webpack中的模块（Chunk）类型</a></li><li class="sidebar-sub-header"><a href="/webpack-book/zh/building/02_bundle_splitting.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/webpack-book/zh/building/03_code_splitting.html" class="sidebar-link">代码分割</a></li><li><a href="/webpack-book/zh/building/04_tidying_up.html" class="sidebar-link">整理</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>优化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>输出</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>技术</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>扩展</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>附录</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="构建拆分"><a href="#构建拆分" aria-hidden="true" class="header-anchor">#</a> 构建拆分</h1><p>目前，应用程序的生产版本是单个JavaScript文件。 如果应用程序已更改，则客户端也必须下载<a href="https://en.wikipedia.org/wiki/Vendor" target="_blank" rel="noopener noreferrer">供应商（vendor）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>依赖内容。</p><p>最好只下载更改的部分。如果供应商依赖项发生更改，则客户端应仅获取供应商依赖项。实际的应用程序代码也是如此。<strong>构建拆分</strong>可以使用<code>optimization.splitChunks.cacheGroups</code>来实现。在生产模式下运行时，<a href="https://gist.github.com/sokra/1522d586b8e5c0f5072d7565c2bee693" target="_blank" rel="noopener noreferrer">webpack4可以开箱即可执行一系列拆分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>但在这种情况下，我们会手动执行某些操作。</p><blockquote><p>要要使bundle无效，必须将哈希附加到生成的bundle中，如：<em>向文件名中注入hash</em>章节中所述。只有这样客户端才能识别请求内容是否改变，进而决定是否下载新的内容。</p></blockquote><h2 id="构建拆分的原理"><a href="#构建拆分的原理" aria-hidden="true" class="header-anchor">#</a> 构建拆分的原理</h2><p>利用构建拆分，你可以将供应商依赖项推送到独立的构建包中，并从客户端级缓存中受益。该过程可以让应用程序在保持整个大小不变的情况下完成。虽然增加了请求的次数，产生了轻微的开销，但是客户端的缓存的弥补了这个成本。</p><p>举个例子。你可以得到 <em>main.js</em>（10 kB）和 <em>vendor.js</em>（90 kB），而不是 <em>main.js</em>（100 kB）。现在，对于已经使用过该应用程序的客户端，对应用程序所做的更改，维护更为廉价。</p><p>使用这种方式，就会面因临缓存而产生的问题。其中之一是缓存失效。解决方法会在 <a href="https://lvzhenbang.github.io/webpack-book/dist/zh/optimizing/04_adding_hashes_to_filenames.html" target="_blank" rel="noopener noreferrer"><em>在文件名中添加hash</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 章节中讨论。</p><p>构建拆分不是唯一的出路。<a href="https://lvzhenbang.github.io/webpack-book/dist/zh/building/03_code_splitting.html" target="_blank" rel="noopener noreferrer"><em>代码分割</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 章节讨论了另一种更细粒度的方法。</p><h2 id="为了实现分离，引入其它依赖"><a href="#为了实现分离，引入其它依赖" aria-hidden="true" class="header-anchor">#</a> 为了实现分离，引入其它依赖</h2><p>鉴于暂时没有什么东西可以拆分供应商（vendor）包，你应该在源文件中引入一些东西。</p><p>在项目中添加React依赖：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> react react-dom --save
</code></pre></div><p>在项目引用它：</p><p><strong>src/index.js</strong></p><div class="language- extra-class"><pre class="language-text"><code>import &quot;react&quot;;
import &quot;react-dom&quot;;
...
</code></pre></div><p>执行 <code>npm run build</code> 脚本命令，然后会输出下面展示的内容：</p><div class="language-bash extra-class"><pre class="language-bash"><code>Hash: 80f9bb6fc04c54949644
Version: webpack 4.1.1
Time: 3276ms
Built at: 3/16/2018 4:59:25 PM
       Asset       Size  Chunks             Chunk Names
     main.js   97.5 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
    main.css   3.49 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
 main.js.map    240 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
main.css.map   85 bytes       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
  index.html  220 bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> main.js main.css main.js.map main.css.map
<span class="token punctuation">..</span>.
</code></pre></div><p>正如你所看到的那样， <em>main.js</em> 非常大。这就是接下来要解决的问题。</p><h2 id="配置-vendor-输出"><a href="#配置-vendor-输出" aria-hidden="true" class="header-anchor">#</a> 配置 <code>vendor</code> 输出</h2><p>在webpack4.x之前，我们使用 <code>CommonsChunkPlugin</code> 来实现构建拆分。现在该插件已被自动化和配置所取代。要从<em>node_modules</em> 目录中提取供应商包，可按如下方式调整代码：</p><p><strong>webpack.config.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> productionConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">...</span>
  <span class="token punctuation">{</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        chunks<span class="token punctuation">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行 <code>npm run build</code> 脚本命令，你将看到如下的输出内容：</p><div class="language-bash extra-class"><pre class="language-bash"><code>Hash: 6c499f10237fdbb07378
Version: webpack 4.1.1
Time: 3172ms
Built at: 3/16/2018 5:00:03 PM
               Asset       Size  Chunks             Chunk Names
     vendors~main.js   96.8 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
             main.js   1.35 KiB       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
            main.css   1.27 KiB       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
    vendors~main.css   2.27 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
 vendors~main.js.map    235 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
vendors~main.css.map   93 bytes       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
         main.js.map   7.11 KiB       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
        main.css.map   85 bytes       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
          index.html  329 bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> vendors~main.js vendors~main.css <span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
</code></pre></div><p>现在构建生成看起来应该像下图说明的那样。</p><p><img src="/webpack-book/assets/img/bundle_02.cc11f7e5.png" alt="应用配置后的主包和供应商包"></p><h2 id="构建拆分的操作"><a href="#构建拆分的操作" aria-hidden="true" class="header-anchor">#</a> 构建拆分的操作</h2><p>你可以针对 <em>node_modules</em> 做明确的匹配，来重写上面的配置，如下所示：</p><p><strong>webpack.config.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> productionConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">...</span>
  <span class="token punctuation">{</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          commons<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">,</span>
            chunks<span class="token punctuation">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你不希望依赖自动化，则使用这种配置可以更好地控制拆分过程。</p><h2 id="拆分和合并模块（chunks）"><a href="#拆分和合并模块（chunks）" aria-hidden="true" class="header-anchor">#</a> 拆分和合并模块（Chunks）</h2><p>Webpack通过两个插件实现对生成的块的更多控制：<code>AggressiveSplittingPlugin</code> 和<code>AggressiveMergingPlugin</code>。</p><p>前者允许你分离出更多和更小的包。由于HTTP/2新标准的工作方式，让这种方式很容易实现。</p><p>以下是 <code>Aggressive</code> 分离的基本思路：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>AggressiveSplittingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        minSize<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
        maxSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>如果你分成多个小构建包，那么缓存会失效，这是需要做一个权衡。此外，你还会在HTTP/1环境中增加请求开销。目前，由于插件中的一个<a href="https://github.com/ampedandwired/html-webpack-plugin/issues/446" target="_blank" rel="noopener noreferrer">错误<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，启用<code>HtmlWebpackPlugin</code> 该插件不起作用。</p><p>而 <code>AggressiveMergingPlugin</code> 插件以相反的方式工作，并允许你将小包组合成更大的：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">AggressiveMergingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        minSizeReduce<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        moveToParents<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>如果使用webpack <strong>记录</strong>，则可以使用这个插件获得良好的缓存行为。这个想法在<em>添加哈希到文件名</em>章节中详细介绍。</p><p><code>webpack.optimize</code> 还包含 <code>LimitChunkCountPlugin</code> 和 <code>MinChunkSizePlugin</code>，它们可以进一步控制构建包大小。</p><blockquote><p>Tobias Koppers 在他的官方博客中，详细的介绍了 <a href="https://medium.com/webpack/webpack-http-2-7083ec3f3ce6" target="_blank" rel="noopener noreferrer">aggressive merging<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote><h2 id="webpack中的模块（chunk）类型"><a href="#webpack中的模块（chunk）类型" aria-hidden="true" class="header-anchor">#</a> webpack中的模块（Chunk）类型</h2><p>在上面的示例中，你使用了不同类型的webpack块。Webpack处理三种类型的块：</p><ul><li><strong>Entry chunks</strong> - 它包含webpack运行时和它随后加载的模块。</li><li><strong>Normal chunks</strong> - 它不包含webpack运行时的模块。相反，是这些可以在应用程序运行时动态加载的模块。一个包装器（例如JSONP）生成这些模块。在下一章代码分割这个主题中，你将生成一个 <code>Normal chunks</code>。</li><li><strong>Initial chunks</strong> - 它是 <code>Normal chunks</code> ，但它用来计算进入应用程序的初始加载时间。作为使用者，你不用关心这些。这是 <code>Initial chunks</code> 和 <code>Normal chunks</code> 之间的区别，这一点很重要。</li></ul><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2><p>与之前相比，现在情况好转。要知道小 <code>main</code> 包与 <code>vendor</code> 包相比如何？如何从此拆分中受益？你需要在设置缓存，下一部分的 <a href="https://lvzhenbang.github.io/webpack-book/dist/zh/optimizing/04_adding_hashes_to_filenames.html" target="_blank" rel="noopener noreferrer"><em>在文件名中添加hash</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一章将详细介绍。</p><p>内容回顾：</p><ul><li>Webpack allows you to split bundles from configuration entries through the <code>optimization.splitChunks.cacheGroups</code> field. It performs 构建拆分 by default in production mode as well.</li><li>A vendor bundle contains the third party code of your project. The vendor dependencies can be detected by inspecting where the modules are imported.</li><li>Webpack offers more control over chunking through specific plugins, such as <code>AggressiveSplittingPlugin</code> and <code>AggressiveMergingPlugin</code>. Mainly the splitting plugin can be handy in HTTP/2 oriented setups.</li><li>Internally webpack relies on three chunk types: entry, normal, and initial chunks.</li></ul><p>在下一章中，你将学习到代码分割和按需加载代码。</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/lvzhenbang/webpack-book/edit/dev/docs/zh/building/02_bundle_splitting.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/webpack-book/zh/building/01_source_maps.html" class="prev">
          Source Maps
        </a></span><span class="next"><a href="/webpack-book/zh/building/03_code_splitting.html">
          代码分割
        </a> →
      </span></p></div></div></div></div>
    <script src="/webpack-book/assets/js/66.5ba4de03.js" defer></script><script src="/webpack-book/assets/js/app.7213af14.js" defer></script>
  </body>
</html>
