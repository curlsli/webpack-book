<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>构建拆分 | webpack surviveJS</title>
    <meta name="description" content="webpack SruriveJS">
    
    
    <link rel="preload" href="/webpack-book/dist/assets/css/styles.3ff0920a.css" as="style"><link rel="preload" href="/webpack-book/dist/assets/js/app.3ff0920a.js" as="script"><link rel="preload" href="/webpack-book/dist/assets/js/66.289e7749.js" as="script"><link rel="prefetch" href="/webpack-book/dist/assets/js/39.64a05b36.js"><link rel="prefetch" href="/webpack-book/dist/assets/css/1.styles.4f8cfa1c.css"><link rel="prefetch" href="/webpack-book/dist/assets/js/1.4f8cfa1c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/2.d4757b93.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/3.ae05c576.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/4.c5ba4651.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/5.a2472f8c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/6.542d275f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/7.a1cb5062.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/8.086e7a4e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/9.f88e1a35.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/10.c8e04b4b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/11.eddd4daf.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/12.bd0b0740.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/13.fdab70f9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/14.362d11ff.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/15.2482b33e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/16.9b7b5d40.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/17.a17e4a39.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/18.8cc3b223.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/19.40535ed2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/20.d9ef9548.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/21.dd176a49.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/22.c7feedd1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/23.81d099fa.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/24.a6019410.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/25.04169afd.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/26.67808a22.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/27.cee93429.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/28.d48927a8.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/29.e1b69cd6.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/30.ce3127e6.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/31.b89ef8bf.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/32.99b09052.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/33.96a6c707.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/34.5b015703.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/35.0cfb24a3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/36.d20addbf.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/37.681925b1.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/38.711f68a2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/40.40e573ea.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/41.4cb32931.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/42.3ae863ec.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/43.65b9c678.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/44.03957b0b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/45.23c4d2a9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/46.d55d3d42.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/47.fe24bc33.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/48.5c148f58.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/49.ffefe0f3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/50.3023ccd2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/51.d50d421b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/52.280cd293.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/53.9b9572f9.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/54.cf991a46.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/55.fd7e34a2.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/56.b9495db7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/57.0a9a51d8.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/58.e4e01c76.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/59.2b8743de.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/60.4ca191a4.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/61.96bf4c0d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/62.bb6eef40.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/63.723bfd8c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/64.619cf063.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/65.7f7aecc5.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/67.7b1e3ba8.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/68.0e3ee8b3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/69.9376a79a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/70.0cb23427.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/71.f5d074e5.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/72.c592143d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/73.2c64a04e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/74.f5567034.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/75.e30961e7.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/76.2ff88d0b.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/77.dd7e5edf.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/78.7a350dea.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/79.24694390.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/80.4f80a679.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/81.37c3261c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/82.8381e276.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/83.b4efc603.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/84.c1acfd5d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/85.7767ccf3.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/86.615edc6a.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/87.42cd871d.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/88.73085312.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/89.2df7e593.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/90.a3111caf.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/91.d2939609.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/92.d793f5cd.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/93.18e01984.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/94.fc7ea5ab.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/95.482ce212.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/96.7d61e67e.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/97.394606bf.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/98.4c6eb05f.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/99.a0713270.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/100.1061814c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/101.838e0b0c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/102.08a8bd85.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/103.24a38648.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/104.0d15b20c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/105.cef1ff87.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/106.446e7977.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/107.397fd38c.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/108.c7bed854.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/109.cd0b9263.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/110.85c592cc.js"><link rel="prefetch" href="/webpack-book/dist/assets/js/111.04c8a22d.js">
    <link rel="stylesheet" href="/webpack-book/dist/assets/css/styles.3ff0920a.css"><link rel="stylesheet" href="/webpack-book/dist/assets/css/1.styles.4f8cfa1c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/webpack-book/dist/" class="home-link router-link-active"><!----><span class="site-name">
      webpack surviveJS
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/dist/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----><a href="/webpack-book/dist/en/" class="nav-link">English</a></li></ul></div></div><a href="https://github.com/lvzhenbang/webpack-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><div class="carbon-ads"></div><ul class="sidebar-links"><li><a href="/webpack-book/dist/" class="sidebar-link">简介</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>指南</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>开发</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>样式</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>加载静态资源</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>构建</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/webpack-book/dist/zh/building/01_source_maps.html" class="sidebar-link">Source Maps</a></li><li><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html" class="active sidebar-link">构建拆分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#构建拆分的原理" class="sidebar-link">构建拆分的原理</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#为了实现分离，引入其它依赖" class="sidebar-link">为了实现分离，引入其它依赖</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#配置-vendor-输出" class="sidebar-link">配置 vendor 输出</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#构建拆分的操作" class="sidebar-link">构建拆分的操作</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#拆分和合并模块（chunks）" class="sidebar-link">拆分和合并模块（Chunks）</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#webpack中的模块（chunk）类型" class="sidebar-link">webpack中的模块（Chunk）类型</a></li><li class="sidebar-sub-header"><a href="/webpack-book/dist/zh/building/02_bundle_splitting.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/webpack-book/dist/zh/building/03_code_splitting.html" class="sidebar-link">代码分割</a></li><li><a href="/webpack-book/dist/zh/building/04_tidying_up.html" class="sidebar-link">整理</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>优化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>输出</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>技术</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>扩展</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>附录</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="构建拆分"><a href="#构建拆分" aria-hidden="true" class="header-anchor">#</a> 构建拆分</h1><p>目前，应用程序的生产版本是单个JavaScript文件。 如果应用程序已更改，则客户端也必须下载<a href="https://en.wikipedia.org/wiki/Vendor" target="_blank" rel="noopener noreferrer">供应商（vendor）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>依赖内容。</p><p>最好只下载更改的部分。如果供应商依赖项发生更改，则客户端应仅获取供应商依赖项。实际的应用程序代码也是如此。<strong>构建拆分</strong>可以使用<code>optimization.splitChunks.cacheGroups</code>来实现。在生产模式下运行时，<a href="https://gist.github.com/sokra/1522d586b8e5c0f5072d7565c2bee693" target="_blank" rel="noopener noreferrer">webpack4可以开箱即可执行一系列拆分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>但在这种情况下，我们会手动执行某些操作。</p><blockquote><p>要要使bundle无效，必须将哈希附加到生成的bundle中，如：<em>向文件名中注入hash</em>章节中所述。只有这样客户端才能识别请求内容是否改变，进而决定是否下载新的内容。</p></blockquote><h2 id="构建拆分的原理"><a href="#构建拆分的原理" aria-hidden="true" class="header-anchor">#</a> 构建拆分的原理</h2><p>利用构建拆分，你可以将供应商依赖项推送到独立的构建包中，并从客户端级缓存中受益。该过程可以让应用程序在保持整个大小不变的情况下完成。虽然增加了请求的次数，产生了轻微的开销，但是客户端的缓存的弥补了这个成本。</p><p>举个例子。你可以得到 <em>main.js</em>（10 kB）和 <em>vendor.js</em>（90 kB），而不是 <em>main.js</em>（100 kB）。现在，对于已经使用过该应用程序的客户端，对应用程序所做的更改，维护更为廉价。</p><p>使用这种方式，就会面因临缓存而产生的问题。其中之一是缓存失效。解决方法会在 <a href="https://lvzhenbang.github.io/webpack-book/dist/zh/optimizing/04_adding_hashes_to_filenames.html" target="_blank" rel="noopener noreferrer"><em>在文件名中添加hash</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 章节中讨论。</p><p>构建拆分不是唯一的出路。<a href="https://lvzhenbang.github.io/webpack-book/dist/zh/building/03_code_splitting.html" target="_blank" rel="noopener noreferrer"><em>代码分割</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 章节讨论了另一种更细粒度的方法。</p><h2 id="为了实现分离，引入其它依赖"><a href="#为了实现分离，引入其它依赖" aria-hidden="true" class="header-anchor">#</a> 为了实现分离，引入其它依赖</h2><p>鉴于暂时没有什么东西可以拆分供应商（vendor）包，你应该在源文件中引入一些东西。</p><p>在项目中添加React依赖：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> react react-dom --save
</code></pre></div><p>在项目引用它：</p><p><strong>src/index.js</strong></p><div class="language- extra-class"><pre class="language-text"><code>import &quot;react&quot;;
import &quot;react-dom&quot;;
...
</code></pre></div><p>执行 <code>npm run build</code> 脚本命令，然后会输出下面展示的内容：</p><div class="language-bash extra-class"><pre class="language-bash"><code>Hash: 80f9bb6fc04c54949644
Version: webpack 4.1.1
Time: 3276ms
Built at: 3/16/2018 4:59:25 PM
       Asset       Size  Chunks             Chunk Names
     main.js   97.5 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
    main.css   3.49 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
 main.js.map    240 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
main.css.map   85 bytes       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
  index.html  220 bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> main.js main.css main.js.map main.css.map
<span class="token punctuation">..</span>.
</code></pre></div><p>正如你所看到的那样， <em>main.js</em> 非常大。这就是接下来要解决的问题。</p><h2 id="配置-vendor-输出"><a href="#配置-vendor-输出" aria-hidden="true" class="header-anchor">#</a> 配置 <code>vendor</code> 输出</h2><p>在webpack4.x之前，我们使用 <code>CommonsChunkPlugin</code> 来实现构建拆分。现在该插件已被自动化和配置所取代。要从<em>node_modules</em> 目录中提取供应商包，可按如下方式调整代码：</p><p><strong>webpack.config.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> productionConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">...</span>
  <span class="token punctuation">{</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        chunks<span class="token punctuation">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行 <code>npm run build</code> 脚本命令，你将看到如下的输出内容：</p><div class="language-bash extra-class"><pre class="language-bash"><code>Hash: 6c499f10237fdbb07378
Version: webpack 4.1.1
Time: 3172ms
Built at: 3/16/2018 5:00:03 PM
               Asset       Size  Chunks             Chunk Names
     vendors~main.js   96.8 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
             main.js   1.35 KiB       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
            main.css   1.27 KiB       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
    vendors~main.css   2.27 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
 vendors~main.js.map    235 KiB       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
vendors~main.css.map   93 bytes       0  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors~main
         main.js.map   7.11 KiB       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
        main.css.map   85 bytes       1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
          index.html  329 bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> vendors~main.js vendors~main.css <span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
</code></pre></div><p>现在构建生成看起来应该像下图说明的那样。</p><p><img src="/webpack-book/dist/assets/img/bundle_02.cc11f7e5.png" alt="应用配置后的主包和供应商包"></p><h2 id="构建拆分的操作"><a href="#构建拆分的操作" aria-hidden="true" class="header-anchor">#</a> 构建拆分的操作</h2><p>你可以针对 <em>node_modules</em> 做明确的匹配，来重写上面的配置，如下所示：</p><p><strong>webpack.config.js</strong></p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> productionConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">...</span>
  <span class="token punctuation">{</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          commons<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">,</span>
            chunks<span class="token punctuation">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你不希望依赖自动化，则使用这种配置可以更好地控制拆分过程。</p><h2 id="拆分和合并模块（chunks）"><a href="#拆分和合并模块（chunks）" aria-hidden="true" class="header-anchor">#</a> 拆分和合并模块（Chunks）</h2><p>Webpack通过两个插件实现对生成的块的更多控制：<code>AggressiveSplittingPlugin</code> 和<code>AggressiveMergingPlugin</code>。</p><p>前者允许你分离出更多和更小的包。由于HTTP/2新标准的工作方式，让这种方式很容易实现。</p><p>以下是 <code>Aggressive</code> 分离的基本思路：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>AggressiveSplittingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        minSize<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
        maxSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>如果你分成多个小构建包，那么缓存会失效，这是需要做一个权衡。此外，你还会在HTTP/1环境中增加请求开销。目前，由于插件中的一个<a href="https://github.com/ampedandwired/html-webpack-plugin/issues/446" target="_blank" rel="noopener noreferrer">错误<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，启用<code>HtmlWebpackPlugin</code> 该插件不起作用。</p><p>而 <code>AggressiveMergingPlugin</code> 插件以相反的方式工作，并允许你将小包组合成更大的：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">AggressiveMergingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        minSizeReduce<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        moveToParents<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>如果使用webpack <strong>记录</strong>，则可以使用这个插件获得良好的缓存行为。这个想法在<em>添加哈希到文件名</em>章节中详细介绍。</p><p><code>webpack.optimize</code> 还包含 <code>LimitChunkCountPlugin</code> 和 <code>MinChunkSizePlugin</code>，它们可以进一步控制构建包大小。</p><blockquote><p>Tobias Koppers 在他的官方博客中，详细的介绍了 <a href="https://medium.com/webpack/webpack-http-2-7083ec3f3ce6" target="_blank" rel="noopener noreferrer">aggressive merging<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote><h2 id="webpack中的模块（chunk）类型"><a href="#webpack中的模块（chunk）类型" aria-hidden="true" class="header-anchor">#</a> webpack中的模块（Chunk）类型</h2><p>在上面的示例中，你使用了不同类型的webpack块。Webpack处理三种类型的块：</p><ul><li><strong>Entry chunks</strong> - 它包含webpack运行时和它随后加载的模块。</li><li><strong>Normal chunks</strong> - 它不包含webpack运行时的模块。相反，是这些可以在应用程序运行时动态加载的模块。一个包装器（例如JSONP）生成这些模块。在下一章代码分割这个主题中，你将生成一个 <code>Normal chunks</code>。</li><li><strong>Initial chunks</strong> - 它是 <code>Normal chunks</code> ，但它用来计算进入应用程序的初始加载时间。作为使用者，你不用关心这些。这是 <code>Initial chunks</code> 和 <code>Normal chunks</code> 之间的区别，这一点很重要。</li></ul><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2><p>与之前相比，现在情况好转。要知道小 <code>main</code> 包与 <code>vendor</code> 包相比如何？如何从此拆分中受益？你需要在设置缓存，下一部分的 <a href="https://lvzhenbang.github.io/webpack-book/dist/zh/optimizing/04_adding_hashes_to_filenames.html" target="_blank" rel="noopener noreferrer"><em>在文件名中添加hash</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一章将详细介绍。</p><p>内容回顾：</p><ul><li>Webpack allows you to split bundles from configuration entries through the <code>optimization.splitChunks.cacheGroups</code> field. It performs 构建拆分 by default in production mode as well.</li><li>A vendor bundle contains the third party code of your project. The vendor dependencies can be detected by inspecting where the modules are imported.</li><li>Webpack offers more control over chunking through specific plugins, such as <code>AggressiveSplittingPlugin</code> and <code>AggressiveMergingPlugin</code>. Mainly the splitting plugin can be handy in HTTP/2 oriented setups.</li><li>Internally webpack relies on three chunk types: entry, normal, and initial chunks.</li></ul><p>在下一章中，你将学习到代码分割和按需加载代码。</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/lvzhenbang/webpack-book/edit/dev/docs/zh/building/02_bundle_splitting.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/webpack-book/dist/zh/building/01_source_maps.html" class="prev">
          Source Maps
        </a></span><span class="next"><a href="/webpack-book/dist/zh/building/03_code_splitting.html">
          代码分割
        </a> →
      </span></p></div><div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div></div></div>
    <script src="/webpack-book/dist/assets/js/66.289e7749.js" defer></script><script src="/webpack-book/dist/assets/js/app.3ff0920a.js" defer></script>
  </body>
</html>
